<!DOCTYPE HTML>

<html>
    <head>
        <script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": ""
        },
        "articleSection" : "post",
        "name" : "Install HomeAssistant on docker &#43; Raspberry PI3",
        "headline" : "Install HomeAssistant on docker &#43; Raspberry PI3",
        "description" : "Goal HomeAssistant running on Raspberry PI is one of way where you don&rsquo;t have to rely on outside services to orchestrate your IOT. Then comes the issues of high availability of the software if only running on one PI. By dockerizing the software first, this open the doors to leverage a kubernetes cluster to ensure HA of the software
Key Aspects  Use the 3 nodes Raspeberry Cluster Access the WIFI, ZWave and Zigbee network Leverage the Nortek HUSBZB-1 Zwave and Zigbee dongle.",
        "inLanguage" : "en",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2018",
        "datePublished": "2018-07-04 00:00:00 &#43;0000 UTC",
        "dateModified" : "2018-07-04 00:00:00 &#43;0000 UTC",
        "url" : "/post/2018-07-04-a/",
        "wordCount" : "1095",
        "keywords" : [ "docker","rpi","homeautomation","Blog" ]
    }
    </script>
        
            
                <title>Install HomeAssistant on docker &#43; Raspberry PI3</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.46" />
        


        
        
            
                <meta name="description" content="Jerome Brette&#39;s Blog">
            
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Install HomeAssistant on docker &#43; Raspberry PI3"/>
<meta name="twitter:description" content="Goal HomeAssistant running on Raspberry PI is one of way where you don&rsquo;t have to rely on outside services to orchestrate your IOT. Then comes the issues of high availability of the software if only running on one PI. By dockerizing the software first, this open the doors to leverage a kubernetes cluster to ensure HA of the software
Key Aspects  Use the 3 nodes Raspeberry Cluster Access the WIFI, ZWave and Zigbee network Leverage the Nortek HUSBZB-1 Zwave and Zigbee dongle."/>
<meta name="twitter:site" content="@example"/>

        <meta property="og:title" content="Install HomeAssistant on docker &#43; Raspberry PI3" />
<meta property="og:description" content="Goal HomeAssistant running on Raspberry PI is one of way where you don&rsquo;t have to rely on outside services to orchestrate your IOT. Then comes the issues of high availability of the software if only running on one PI. By dockerizing the software first, this open the doors to leverage a kubernetes cluster to ensure HA of the software
Key Aspects  Use the 3 nodes Raspeberry Cluster Access the WIFI, ZWave and Zigbee network Leverage the Nortek HUSBZB-1 Zwave and Zigbee dongle." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/2018-07-04-a/" />



<meta property="article:published_time" content="2018-07-04T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2018-07-04T00:00:00&#43;00:00"/>











        <meta property="og:image" content="/images/logo.png">
        <meta property="og:image:type" content="image/png">
        <meta property="og:image:width" content="512">
        <meta property="og:image:height" content="512">
        
<meta itemprop="name" content="Install HomeAssistant on docker &#43; Raspberry PI3">
<meta itemprop="description" content="Goal HomeAssistant running on Raspberry PI is one of way where you don&rsquo;t have to rely on outside services to orchestrate your IOT. Then comes the issues of high availability of the software if only running on one PI. By dockerizing the software first, this open the doors to leverage a kubernetes cluster to ensure HA of the software
Key Aspects  Use the 3 nodes Raspeberry Cluster Access the WIFI, ZWave and Zigbee network Leverage the Nortek HUSBZB-1 Zwave and Zigbee dongle.">


<meta itemprop="datePublished" content="2018-07-04T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2018-07-04T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1095">



<meta itemprop="keywords" content="docker,rpi,homeautomation," />

        

        
            
        

        
        
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700">
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css">
            <link rel="stylesheet" href="/css/main.css">
            <link rel="stylesheet" href="/css/add-on.css">
            <link rel="stylesheet" href="/css/academicons.min.css">
        

        
            
                
            
        


  
    
    <link href='//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css' rel='stylesheet' type='text/css' />
  


      
<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-123357787-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    </head>
    <body>

      
      <div id="wrapper">

    
    
<header id="header">
    
      <h1><a href="/">post</a></h1>
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="/">
                            <i class="fa fa-home">&nbsp;</i>Home
                    </a>
                </li>
            
                <li>
                    <a href="/about/">
                            <i class="fa fa-id-card-o">&nbsp;</i>About
                    </a>
                </li>
            
                <li>
                    <a href="/post/">
                            <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                    </a>
                </li>
            
                <li>
                    <a href="/tags/">
                            <i class="fa fa-list">&nbsp;</i>Tags
                    </a>
                </li>
            
                <li>
                    <a href="/categories/">
                            <i class="fa fa-sitemap">&nbsp;</i>Categories
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li id="share-nav" class="share-menu" style="display:none;">
                <a class="fa-share-alt" href="#share-menu">Share</a>
            </li>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="as_sitesearch" value="">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="as_sitesearch" value="">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="/">
                            <h3>
                                <i class="fa fa-home">&nbsp;</i>Home
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/about/">
                            <h3>
                                <i class="fa fa-id-card-o">&nbsp;</i>About
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/post/">
                            <h3>
                                <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags/">
                            <h3>
                                <i class="fa fa-list">&nbsp;</i>Tags
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/categories/">
                            <h3>
                                <i class="fa fa-sitemap">&nbsp;</i>Categories
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section class="recent-posts">
            <div class="mini-posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                

                
                    
                

                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/2018-09-28-a/">Upgrade RPI Kubernetes cluster to 1.12</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-09-29'>
                                    September 29, 2018</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/2018-08-01-a/">Build and Deploy Kubernetes Hashicorp Vault</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-08-01'>
                                    August 1, 2018</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/2018-07-31-a/">Build and Deploy Kubernetes Istio</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-07-31'>
                                    July 31, 2018</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/2018-07-30-a/">Build and Deploy Kubernetes test-infra</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-07-30'>
                                    July 30, 2018</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/2018-07-29-a/">Build and Deploy Kubernetes Kustomize</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-07-29'>
                                    July 29, 2018</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/2018-07-28-a/">Deploy Cassandra on Raspberry-PI 3</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-07-28'>
                                    July 28, 2018</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/2018-07-19-a/">Build and Deploy MachineLearning Kubeflow Framework</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-07-19'>
                                    July 19, 2018</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/2018-07-18-a/">Compile and Test Portieris</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-07-18'>
                                    July 18, 2018</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/2018-07-17-a/">Rebuild Calico for AMD64 ad ARM32V7</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-07-17'>
                                    July 17, 2018</time>
                            </header>
                            

                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/post/2018-07-16-a/">Rebuild Hyperkube images</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-07-16'>
                                    July 16, 2018</time>
                            </header>
                            

                        </article>
                

                
                    <a href=
                        
                            /post/
                        
                        class="button">View more posts</a>
                
            </div>
        </section>

    
        
</section>

    <section id="share-menu">
    <section id="social-share-nav">
        <ul class="links">
            <header>
                <h3>Share this post <i class="fa fa-smile-o"></i></h3>
            </header>
            



<li>
  <a href="//twitter.com/share?url=%2fpost%2f2018-07-04-a%2f&amp;text=Install%20HomeAssistant%20on%20docker%20%2b%20Raspberry%20PI3&amp;via=example" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
    </a>
</li>




<li>
  <a href="//plus.google.com/share?url=%2fpost%2f2018-07-04-a%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
  </a>
</li>





<li>
  <a href="//www.facebook.com/sharer/sharer.php?u=%2fpost%2f2018-07-04-a%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
    </a>
</li>




<li>
  <a href="//reddit.com/submit?url=%2fpost%2f2018-07-04-a%2f&amp;title=Install%20HomeAssistant%20on%20docker%20%2b%20Raspberry%20PI3" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
  </a>
</li>




<li>
  <a href="//www.linkedin.com/shareArticle?url=%2fpost%2f2018-07-04-a%2f&amp;title=Install%20HomeAssistant%20on%20docker%20%2b%20Raspberry%20PI3" target="_blank" class="share-btn linkedin">
      <i class="fa fa-linkedin"></i>
      <p>LinkedIn</p>
    </a>
</li>




<li>
  <a href="//www.stumbleupon.com/submit?url=%2fpost%2f2018-07-04-a%2f&amp;title=Install%20HomeAssistant%20on%20docker%20%2b%20Raspberry%20PI3" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
  </a>
</li>




<li>
  <a href="//www.pinterest.com/pin/create/button/?url=%2fpost%2f2018-07-04-a%2f&amp;description=Install%20HomeAssistant%20on%20docker%20%2b%20Raspberry%20PI3" target="_blank" class="share-btn pinterest">
    <i class="fa fa-pinterest-p"></i>
    <p>Pinterest</p>
  </a>
</li>




<li>
  <a href="mailto:?subject=Check out this post by &amp;body=%2fpost%2f2018-07-04-a%2f" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
  </a>
</li>


        </ul>
    </section>
</section>

    
    <div id="main">
        
        
        <article class="post">
  <header>
    <div class="title">
        
            <h1><a href="/post/2018-07-04-a/">Install HomeAssistant on docker &#43; Raspberry PI3</a></h1>
            
        
        
    </div>
    <div class="meta">
        

        <time class="published"
            datetime='2018-07-04'>
            July 4, 2018</time>
        <span class="author"></span>
        
            <p>6 minute read</p>
        
        
    </div>
</header>


  
    <section id="social-share">
      <ul class="icons">
        



<li>
  <a href="//twitter.com/share?url=%2fpost%2f2018-07-04-a%2f&amp;text=Install%20HomeAssistant%20on%20docker%20%2b%20Raspberry%20PI3&amp;via=example" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
    </a>
</li>




<li>
  <a href="//plus.google.com/share?url=%2fpost%2f2018-07-04-a%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
  </a>
</li>





<li>
  <a href="//www.facebook.com/sharer/sharer.php?u=%2fpost%2f2018-07-04-a%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
    </a>
</li>




<li>
  <a href="//reddit.com/submit?url=%2fpost%2f2018-07-04-a%2f&amp;title=Install%20HomeAssistant%20on%20docker%20%2b%20Raspberry%20PI3" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
  </a>
</li>




<li>
  <a href="//www.linkedin.com/shareArticle?url=%2fpost%2f2018-07-04-a%2f&amp;title=Install%20HomeAssistant%20on%20docker%20%2b%20Raspberry%20PI3" target="_blank" class="share-btn linkedin">
      <i class="fa fa-linkedin"></i>
      <p>LinkedIn</p>
    </a>
</li>




<li>
  <a href="//www.stumbleupon.com/submit?url=%2fpost%2f2018-07-04-a%2f&amp;title=Install%20HomeAssistant%20on%20docker%20%2b%20Raspberry%20PI3" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
  </a>
</li>




<li>
  <a href="//www.pinterest.com/pin/create/button/?url=%2fpost%2f2018-07-04-a%2f&amp;description=Install%20HomeAssistant%20on%20docker%20%2b%20Raspberry%20PI3" target="_blank" class="share-btn pinterest">
    <i class="fa fa-pinterest-p"></i>
    <p>Pinterest</p>
  </a>
</li>




<li>
  <a href="mailto:?subject=Check out this post by &amp;body=%2fpost%2f2018-07-04-a%2f" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
  </a>
</li>


      </ul>
    </section>
  

  

  <div id="content">
    

<h1 id="goal">Goal</h1>

<p>HomeAssistant running on Raspberry PI is one of way where you don&rsquo;t have to rely on outside
services to orchestrate your IOT. Then comes the issues of high availability of the software
if only running on one PI. By dockerizing the software first, this open the doors to leverage
a kubernetes cluster to ensure HA of the software</p>

<h2 id="key-aspects">Key Aspects</h2>

<ul>
<li>Use the 3 nodes Raspeberry Cluster</li>
<li>Access the WIFI, ZWave and Zigbee network</li>
<li>Leverage the Nortek HUSBZB-1 Zwave and Zigbee dongle.</li>
<li>Install <a href="https://www.home-assistant.io/">Home Assistant</a> on node 2 of the cluster</li>
</ul>

<p><img src="/images/raspberrypi/IMG_0344.JPG" alt="" /></p>

<h2 id="what-os">What OS</h2>

<ul>
<li><a href="https://www.home-assistant.io/hassio/installation/">Home Assistant haas.io</a> does not support Raspberry 3 B+ yet.</li>
<li>haas.io is based on ResinOS. <a href="https://resinos.io/#downloads-raspberrypi">ResinOS</a> is not using docker anymore but balena which does not support kubernetes yet <a href="https://github.com/resin-os/balena/issues/84">See Issue</a></li>
<li>Continue to use HyperiotOS</li>
</ul>

<h2 id="install-apparmor-and-download-docker-container">Install AppArmor and download docker container</h2>

<pre><code>cat newpgklist

apparmor-utils
apt-transport-https
avahi-daemon
ca-certificates
curl
dbus
jq
network-manager
socat
software-properties-common
</code></pre>

<pre><code>for i in `cat newpgklist`
do
sudo apt-get install -y $i
done
</code></pre>

<p>Download and run the installation script. Will attempt to replace it by Kubernetes/Helm script.</p>

<pre><code>curl -sL https://raw.githubusercontent.com/home-assistant/hassio-build/master/install/hassio_install &gt; hassio_install
./hassio_install -m raspberrypi3
</code></pre>

<h2 id="installed-services">Installed Services</h2>

<h3 id="hassio-apparmor-service">hassio-apparmor service</h3>

<pre><code>cat /etc/systemd/system/hassio-apparmor.service

[Unit]
Description=Hass.io AppArmor
Wants=hassio-supervisor.service
Before=docker.service hassio-supervisor.service

[Service]
Type=oneshot
RemainAfterExit=true
ExecStart=/usr/sbin/hassio-apparmor

[Install]
WantedBy=multi-user.target
</code></pre>

<pre><code>cat /usr/sbin/hassio-apparmor

#!/bin/sh
set -e

# Load configs
CONFIG_FILE=/etc/hassio.json

# Read configs
DATA=&quot;$(jq --raw-output '.data // &quot;/usr/share/hassio&quot;' ${CONFIG_FILE})&quot;
PROFILES_DIR=${DATA}/apparmor
CACHE_DIR=&quot;${PROFILES_DIR}/cache&quot;
REMOVE_DIR=&quot;${PROFILES_DIR}/remove&quot;

# Exists AppArmor
if ! command -v apparmor_parser &gt; /dev/null 2&gt;&amp;1; then
    echo &quot;[Warning]: No apparmor_parser on host system!&quot;
    exit 0
fi

# Check folder structure
mkdir -p ${PROFILES_DIR}
mkdir -p ${CACHE_DIR}
mkdir -p ${REMOVE_DIR}

# Load/Update exists/new profiles
for profile in ${PROFILES_DIR}/*; do
    if [ ! -f ${profile} ]; then
        continue
    fi

    # Load Profile
    if ! apparmor_parser -r -W -L ${CACHE_DIR} ${profile}; then
        echo &quot;[Error]: Can't load profile ${profile}&quot;
    fi
done

# Cleanup old profiles
for profile in ${REMOVE_DIR}/*; do
    if [ ! -f ${profile} ]; then
        continue
    fi

    # Unload Profile
    if apparmor_parser -R -W -L ${CACHE_DIR} ${profile}; then
        if rm ${profile}; then
            continue
        fi
    fi
    echo &quot;[Error]: Can't remove profile ${profile}&quot;
done
</code></pre>

<h3 id="hassio-supervisor-service">hassio-supervisor service</h3>

<p>Main run seems to start hassio-supervisor</p>

<pre><code>cat /etc/systemd/system/hassio-supervisor.service

[Unit]
Description=Hass.io supervisor
Requires=docker.service
After=docker.service dbus.socket

[Service]
Type=simple
Restart=always
RestartSec=5s
ExecStartPre=-/usr/bin/docker stop hassio_supervisor
ExecStart=/usr/sbin/hassio-supervisor
ExecStop=-/usr/bin/docker stop hassio_supervisor

[Install]
WantedBy=multi-user.target
</code></pre>

<pre><code>cat /usr/sbin/hassio-supervisor

#!/bin/sh
set -e

# Load configs
CONFIG_FILE=/etc/hassio.json

SUPERVISOR=&quot;$(jq --raw-output '.supervisor' ${CONFIG_FILE})&quot;
HOMEASSISTANT=&quot;$(jq --raw-output '.homeassistant' ${CONFIG_FILE})&quot;
DATA=&quot;$(jq --raw-output '.data // &quot;/usr/share/hassio&quot;' ${CONFIG_FILE})&quot;

# AppArmor Support
if command -v apparmor_parser &gt; /dev/null 2&gt;&amp;1 &amp;&amp; grep hassio-supervisor /sys/kernel/security/apparmor/profiles &gt; /dev/null 2&gt;&amp;1; then
    APPARMOR=&quot;--security-opt apparmor=hassio-supervisor&quot;
else
    APPARMOR=&quot;--security-opt apparmor=unconfined&quot;
fi

# Init supervisor
HASSIO_DATA=${DATA}
HASSIO_IMAGE_ID=$(docker inspect --format='{{.Id}}' ${SUPERVISOR})
HASSIO_CONTAINER_ID=$(docker inspect --format='{{.Image}}' hassio_supervisor || echo &quot;&quot;)

runSupervisor() {
    docker rm --force hassio_supervisor || true
    docker run --name hassio_supervisor \
        $APPARMOR \
        --security-opt seccomp=unconfined \
        -v /var/run/docker.sock:/var/run/docker.sock \
        -v /var/run/dbus:/var/run/dbus \
        -v ${HASSIO_DATA}:/data \
        -e SUPERVISOR_SHARE=${HASSIO_DATA} \
        -e SUPERVISOR_NAME=hassio_supervisor \
        -e HOMEASSISTANT_REPOSITORY=${HOMEASSISTANT} \
        ${SUPERVISOR}
}

# Run supervisor
mkdir -p ${HASSIO_DATA}
([ &quot;${HASSIO_IMAGE_ID}&quot; = &quot;${HASSIO_CONTAINER_ID}&quot; ] &amp;&amp; docker start --attach hassio_supervisor) || runSupervisor
</code></pre>

<h2 id="docker-traces">Docker traces</h2>

<p>docker ps shows homeassistance images downloaded but no controlled yet by Kubernetes</p>

<pre><code>sudo docker ps

CONTAINER ID        IMAGE                                      COMMAND                  CREATED             STATUS              PORTS               NAMES
e1fd86ed3b20        homeassistant/raspberrypi3-homeassistant   &quot;/bin/entry.sh pytho…&quot;   28 minutes ago      Up 28 minutes                           homeassistant
f05058843583        homeassistant/armhf-hassio-supervisor      &quot;python3 -m hassio&quot;      30 minutes ago      Up 30 minutes                           hassio_supervisor

65d89478378b        d7ebe361fe95                               &quot;/usr/local/bin/kube…&quot;   30 minutes ago      Up 30 minutes                           k8s_kube-proxy_kube-proxy-4chwh_kube-system_68b68391-80b7-11e8-acaf-b827ebd5ad4c_2
9b8c7c2d431e        k8s.gcr.io/pause:3.1                       &quot;/pause&quot;                 30 minutes ago      Up 30 minutes                           k8s_POD_kube-proxy-4chwh_kube-system_68b68391-80b7-11e8-acaf-b827ebd5ad4c_2
8513e6cc5125        184e05022e7f                               &quot;/opt/bin/flanneld -…&quot;   About an hour ago   Up About an hour                        k8s_kube-flannel_kube-flannel-ds-wqxsz_kube-system_95f94b5f-80ba-11e8-acaf-b827ebd5ad4c_2
1aee6f79fe8e        k8s.gcr.io/pause:3.1                       &quot;/pause&quot;                 About an hour ago   Up About an hour                        k8s_POD_kube-flannel-ds-wqxsz_kube-system_95f94b5f-80ba-11e8-acaf-b827ebd5ad4c_1

</code></pre>

<pre><code># docker attach --sig-proxy=false f05058843583

18-07-06 06:50:19 INFO (MainThread) [hassio.addons] Load addons: 41 all - 41 new - 0 remove
18-07-06 06:50:19 INFO (MainThread) [hassio.updater] Fetch update data from https://s3.amazonaws.com/hassio-version/stable.json
18-07-06 06:50:19 INFO (MainThread) [hassio.snapshots] Found 0 snapshot files
18-07-06 06:50:19 INFO (MainThread) [__main__] Run HassIO
18-07-06 06:50:19 INFO (MainThread) [hassio.misc.dns] Start DNS port forwarding for host add-ons
18-07-06 06:50:19 INFO (MainThread) [hassio.core] Ignore Hass.io auto updates on dev channel
18-07-06 06:50:19 INFO (MainThread) [hassio.core] Start API on 172.30.32.2
18-07-06 06:50:19 INFO (MainThread) [hassio.addons] Startup initialize run 0 addons
18-07-06 06:50:19 INFO (MainThread) [hassio.addons] Startup system run 0 addons
18-07-06 06:50:19 INFO (MainThread) [hassio.addons] Startup services run 0 addons
18-07-06 06:50:21 INFO (SyncWorker_0) [hassio.docker.homeassistant] Start homeassistant homeassistant/raspberrypi3-homeassistant with version 0.73.0b6
18-07-06 06:51:01 INFO (MainThread) [hassio.homeassistant] Detect a running Home-Assistant instance
18-07-06 06:51:01 INFO (MainThread) [hassio.addons] Startup application run 0 addons
18-07-06 06:51:01 INFO (MainThread) [hassio.tasks] All core tasks are scheduled
18-07-06 06:51:01 INFO (MainThread) [hassio.core] Hass.io is up and running
</code></pre>

<h3 id="first-setup">First Setup</h3>

<p><img src="/images/homeassistant/HomeAssistant.png" alt="" /></p>

<h3 id="zigbee-zwave-support">Zigbee/ZWave support</h3>

<h3 id="enable-the-zigbee-zwave-dongle">Enable the zigbee/zwave dongle</h3>

<p>Locate the container</p>

<pre><code>sudo docker ps | grep homea

1fba92d1b40e        homeassistant/raspberrypi3-homeassistant   &quot;/bin/entry.sh pytho…&quot;   34 minutes ago      Up 34 minutes                           homeassistant
4c3f66563a3c        homeassistant/armhf-hassio-supervisor      &quot;python3 -m hassio&quot;      6 hours ago         Up 34 minutes                           hassio_supervisor
</code></pre>

<p>Enter the docker container</p>

<pre><code>sudo docker exec -ti 1fba92d1b40e /bin/bash
</code></pre>

<p>Edit the configuration file</p>

<pre><code>vi /config/configuration.yaml

zwave:
  usb_path: /dev/ttyUSB0

zha:
  usb_path: /dev/ttyUSB1
  database_path: /config/zigbee.db
</code></pre>

<p>Reload the configuration file
Access the UI and invoked reload core</p>

<pre><code>http://192.168.1.92:8123/config/core
</code></pre>

<pre><code>sudo docker ps | grep homea

702fd9424bfd        homeassistant/raspberrypi3-homeassistant   &quot;/bin/entry.sh pytho…&quot;   40 seconds ago      Up 38 seconds                           homeassistant
4c3f66563a3c        homeassistant/armhf-hassio-supervisor      &quot;python3 -m hassio&quot;      6 hours ago         Up 43 minutes                           hassio_supervisor
</code></pre>

<p>Let&rsquo;s get back in zigbee.db now exists</p>

<pre><code>sudo docker exec -ti 702fd9424bfd /bin/bash

bash-4.4# ls -lt
total 1928
-rw-r--r--    1 root     root       1802240 Jul  6 21:05 home-assistant_v2.db
-rw-r--r--    1 root     root         32768 Jul  6 21:05 home-assistant_v2.db-shm
-rw-r--r--    1 root     root            32 Jul  6 21:05 home-assistant_v2.db-wal
-rw-r--r--    1 root     root         14971 Jul  6 21:05 OZW_Log.txt
-rw-r--r--    1 root     root         45056 Jul  6 21:05 zigbee.db
-rw-r--r--    1 root     root           227 Jul  6 21:05 home-assistant.log
-rw-r--r--    1 root     root         32768 Jul  6 21:05 pyozw.sqlite
-rw-r--r--    1 root     root          1122 Jul  6 21:05 options.xml
-rw-r--r--    1 root     root          1866 Jul  6 21:01 configuration.yaml
drwxr-xr-x    2 root     root          4096 Jul  6 06:50 tts
-rw-r--r--    1 root     root             2 Jul  6 06:50 automations.yaml
-rw-r--r--    1 root     root             0 Jul  6 06:50 customize.yaml
-rw-r--r--    1 root     root             0 Jul  6 06:50 groups.yaml
-rw-r--r--    1 root     root             0 Jul  6 06:50 scripts.yaml
-rw-r--r--    1 root     root           157 Jul  6 06:50 secrets.yaml
drwxr-xr-x    2 root     root          4096 Jul  6 06:50 deps
</code></pre>

<h3 id="homeassistant-ui-screenshots">HomeAssistant UI Screenshots</h3>

<p><img src="/images/homeassistant/Overview1.png" alt="" />
<img src="/images/homeassistant/Overview2.png" alt="" /></p>

<h2 id="conclusion">Conclusion</h2>

<ul>
<li>Installation could not proceed further without solving the ZWave SUC Controller aspect.</li>
<li>Not willing to break my Lowe&rsquo;s IRIS based network yet and wanted to used Raspberry PI as a SUC Controller (see other post)</li>
<li>Also need to understand how to create persistency volume in Kubernetes in the PI Cluster (see other post)</li>
<li>Will be able to remove the dedicated the systemctl services since Kubernetes will control thoses.</li>
</ul>

<h2 id="links-and-repos">Links and Repos</h2>

<p>Discovery seems to need &ndash;network host if you want to discover the UPnP devices</p>

<ul>
<li><a href="https://www.home-assistant.io/components/discovery/">Link1</a></li>
<li><a href="https://github.com/jbrette/haas-helm">GitHUB associated repo</a></li>
</ul>

  </div>

  <footer>
    <ul class="stats">
  <li class="categories">
    <ul>
        
            
            
                <i class="fa fa-folder"></i>
                
                
                <li><a class="article-category-link" href="categories/wiki">wiki</a></li>
                
            
        
    </ul>
  </li>
  <li class="tags">
    <ul>
        
            
            
                <i class="fa fa-tags"></i>
                
                
                <li><a class="article-category-link" href="tags/docker">docker</a></li>
                
                
                <li><a class="article-category-link" href="tags/rpi">rpi</a></li>
                
                
                <li><a class="article-category-link" href="tags/homeautomation">homeautomation</a></li>
                
            
        
    </ul>
  </li>
</ul>

  </footer>

</article>

    <article class="post">
        <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "jbrette" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </article>


<ul class="actions pagination">
    
        <li><a href="/post/2018-07-03-a/"
                class="button big previous">Creating a Raspberry 3 B&#43; Kubernetes Cluster</a></li>
    

    
        <li><a href="/post/2018-07-05-a/"
                class="button big next">Install OpenHAB on docker &#43; Raspberry PI3</a></li>
    
</ul>


    </div>
    
<section id="sidebar">

  
  <section id="intro">
    
    
      
        <a href='/'><img src="/images/logo.png" class="intro-circle" width="" alt="avatar" /></a>
      
    
    
      <header>
        <h2>Jerome&#39;s Blog</h2>
        <p>Building my edge cloud using Raspberry PI, keep learning from the opensource community</p>
      </header>
    
    
      <ul class="icons">
        
          
    <li><a href="/index.xml" type="application/rss+xml" target="_blank" title="RSS" class="fa fa-rss"></a></li>


        
        
  <li><a href="//github.com/jbrette" target="_blank" title="GitHub" class="fa fa-github"></a></li>

























  <li><a href="//linkedin.com/in/jerome-brette-109b8711" target="_blank" title="LinkedIn" class="fa fa-linkedin"></a></li>



































  <li><a href="//twitter.com/example" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>




















      </ul>
    
  </section>

  
  <section class="recent-posts">
    <div class="mini-posts">
      <header>
        <h3>Recent Posts</h3>
      </header>
      <div class="posts-container">
        

        
          
        

        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/2018-09-28-a/">Upgrade RPI Kubernetes cluster to 1.12</a>
              </h3>
              
              <time class="published" datetime='2018-09-29'>
                September 29, 2018
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/2018-08-01-a/">Build and Deploy Kubernetes Hashicorp Vault</a>
              </h3>
              
              <time class="published" datetime='2018-08-01'>
                August 1, 2018
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/2018-07-31-a/">Build and Deploy Kubernetes Istio</a>
              </h3>
              
              <time class="published" datetime='2018-07-31'>
                July 31, 2018
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/2018-07-30-a/">Build and Deploy Kubernetes test-infra</a>
              </h3>
              
              <time class="published" datetime='2018-07-30'>
                July 30, 2018
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/2018-07-29-a/">Build and Deploy Kubernetes Kustomize</a>
              </h3>
              
              <time class="published" datetime='2018-07-29'>
                July 29, 2018
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/2018-07-28-a/">Deploy Cassandra on Raspberry-PI 3</a>
              </h3>
              
              <time class="published" datetime='2018-07-28'>
                July 28, 2018
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/2018-07-19-a/">Build and Deploy MachineLearning Kubeflow Framework</a>
              </h3>
              
              <time class="published" datetime='2018-07-19'>
                July 19, 2018
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/2018-07-18-a/">Compile and Test Portieris</a>
              </h3>
              
              <time class="published" datetime='2018-07-18'>
                July 18, 2018
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/2018-07-17-a/">Rebuild Calico for AMD64 ad ARM32V7</a>
              </h3>
              
              <time class="published" datetime='2018-07-17'>
                July 17, 2018
              </time>
            </header>
            

          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/post/2018-07-16-a/">Rebuild Hyperkube images</a>
              </h3>
              
              <time class="published" datetime='2018-07-16'>
                July 16, 2018
              </time>
            </header>
            

          </article>
        
      </div>

      
        <a href=
          
            /post/
          
        class="button">View more posts</a>
      
    </div>
  </section>

  
  
  
  
  
    <section id="categories">
      <header>
        <h3>
          <a href="/categories/">Categories</a>
        </h3>
      </header>
        
          
        

        
        <p>
          <article>
            <header>
              
                <a href="/categories/wiki/">wiki</a>
                <span style="float:right;">35</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/wip/">wip</a>
                <span style="float:right;">13</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/news/">news</a>
                <span style="float:right;">2</span>
              
            </header>
          </article>
        </p>
        
    </section>
  
  

  
  
    <section id="mini-bio">
      <h3>About</h3>
      <p>About the author</p>
      <a href="/about/" class="button">Learn More</a>
    </section>
  

  
  <section id="footer">
    
      <ul class="icons">
        
          
    <li><a href="/index.xml" type="application/rss+xml" target="_blank" title="RSS" class="fa fa-rss"></a></li>


        
        
  <li><a href="//github.com/jbrette" target="_blank" title="GitHub" class="fa fa-github"></a></li>

























  <li><a href="//linkedin.com/in/jerome-brette-109b8711" target="_blank" title="LinkedIn" class="fa fa-linkedin"></a></li>



































  <li><a href="//twitter.com/example" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>




















      </ul>
    
    <p class="copyright">
      
        &copy; 2018
        
          Jerome Brette&#39;s Blog
        
      .
      Powered by <a href="//gohugo.io" target="_blank">Hugo</a>
    </p>
  </section>
</section>

    </div>
    <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
    

    
      
    

    
      
      
      
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js"></script>
        
        
        
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/yaml.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/css.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/bash.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/python.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/golang.min.js"></script>
        <script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script>
      <script src="/js/util.js"></script>
      <script src="/js/main.js"></script>
      <script src="/js/backToTop.js"></script>
    

    
      
        
      
    

    
    <script>hljs.initHighlightingOnLoad();</script>
      <script src="//yihui.name/js/math-code.js"></script>
<script async
src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


  </body>
</html>

