<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.49" />
    <meta name="description" content="KUBEDGE">
<meta name="author" content="Kubedge Team">

    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link rel="icon" href="/images/favicon.png" type="image/x-icon" />
    <title>Using Ansible to manage Raspberry PI cluster :: KUBEDGE&#39;s Blog</title>

    
    <link href="/css/nucleus.css?1540673754" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1540673754" rel="stylesheet">
    <link href="/css/hybrid.css?1540673754" rel="stylesheet">
    <link href="/css/featherlight.min.css?1540673754" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1540673754" rel="stylesheet">
    <link href="/css/auto-complete.css?1540673754" rel="stylesheet">
    <link href="/css/theme.css?1540673754" rel="stylesheet">
    <link href="/css/hugo-theme.css?1540673754" rel="stylesheet">
    
      <link href="/css/theme-kubedge.css?1540673754" rel="stylesheet">
    

    <script src="/js/jquery-2.x.min.js?1540673754"></script>

    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/pi_cluster/os_installation/children/ansible/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="">
  <svg id="grav-logo" width="100%" height="100%" viewBox="0 0 504 140" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">
    <path d="M235.832,71.564l-7.98,-0.001c-1.213,0.001 -2.197,0.987 -2.197,2.204l0,15.327l-0.158,0.132c-4.696,3.962 -10.634,6.14 -16.719,6.14c-14.356,0 -26.034,-11.68 -26.034,-26.037c0,-14.358 11.678,-26.035 26.034,-26.035c5.582,0 10.919,1.767 15.437,5.113c0.877,0.649 2.093,0.56 2.866,-0.211l5.69,-5.69c0.444,-0.442 0.675,-1.055 0.639,-1.681c-0.034,-0.627 -0.336,-1.206 -0.828,-1.597c-6.76,-5.363 -15.214,-8.314 -23.805,-8.314c-21.18,0 -38.414,17.233 -38.414,38.415c0,21.183 17.234,38.415 38.414,38.415c10.937,0 21.397,-4.705 28.698,-12.914c0.358,-0.403 0.556,-0.921 0.556,-1.46l0,-19.603c0,-1.217 -0.985,-2.203 -2.2,-2.203"
      style="fill:#000;fill-rule:nonzero;"></path>
  </svg>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-close"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1540673754"></script>
<script type="text/javascript" src="/js/auto-complete.js?1540673754"></script>
<script type="text/javascript">
    
        var baseurl = "";
    
</script>
<script type="text/javascript" src="/js/search.js?1540673754"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/post/" title="Latest News" class="dd-item 
        
        
        
        ">
      <a href="/post/">
          Latest News
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/devops/" title="DevOps" class="dd-item 
        
        
        
        ">
      <a href="/devops/">
          <b>1. </b>DevOps
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/devops/git_gerrit/" title="Git/Gerrit" class="dd-item 
        
        
        
        ">
      <a href="/devops/git_gerrit/">
          <b>1.1. </b>Git &amp; Gerrit
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/devops/git_gerrit/children/2018-06-25-a/" title="Setup github/gerrit behind a corporate http proxy" class="dd-item ">
        <a href="/devops/git_gerrit/children/2018-06-25-a/">
        Corporate Proxy
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/devops/git_gerrit/children/2018-06-23-a/" title="Setup multiple GitHub account on a single machine" class="dd-item ">
        <a href="/devops/git_gerrit/children/2018-06-23-a/">
        Multiple GitHub accounts
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/devops/cicd/" title="CI/CD" class="dd-item 
        
        
        
        ">
      <a href="/devops/cicd/">
          <b>1.2. </b>CI/CD
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/devops/hugo_githubpages/" title="Hugo/GitHubPages" class="dd-item 
        
        
        
        ">
      <a href="/devops/hugo_githubpages/">
          <b>1.3. </b>Hugo &amp; GitHub pages
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/devops/kubedgesdk/" title="Kubedge SDK" class="dd-item 
        
        
        
        ">
      <a href="/devops/kubedgesdk/">
          <b>1.4. </b>Kubedge SDK
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/devops/kubedgesdk/children/2018-07-15-a/" title="Recompile Kubernetes components for Raspberry PI" class="dd-item ">
        <a href="/devops/kubedgesdk/children/2018-07-15-a/">
        Kubernetes cross-compilation
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/devops/kubedgesdk/children/2018-06-21-a/" title="Setup SingleNode Kubernetes Cluster using kubeadm" class="dd-item ">
        <a href="/devops/kubedgesdk/children/2018-06-21-a/">
        SingleNode Kubernetes
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/devops/advanced/" title="Advanced &amp; WIP" class="dd-item 
        
        
        
        ">
      <a href="/devops/advanced/">
          <b>1.5. </b>Advanced &amp; WIP
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/devops/advanced/children/2018-07-16-a/" title="Rebuild Hyperkube images" class="dd-item ">
        <a href="/devops/advanced/children/2018-07-16-a/">
        Hyperkube images
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/devops/advanced/children/2018-06-26-a/" title="Zuul" class="dd-item ">
        <a href="/devops/advanced/children/2018-06-26-a/">
        Zuul
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/pi_cluster/" title="RPI Cluster" class="dd-item 
        parent
        
        
        ">
      <a href="/pi_cluster/">
          <b>2. </b>RPI Cluster
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/pi_cluster/os_installation/" title="Operating System" class="dd-item 
        parent
        
        
        ">
      <a href="/pi_cluster/os_installation/">
          <b>2.1. </b>Operating System
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/os_installation/children/cluster_assembly/" title="Raspberry PI cluster Assembly" class="dd-item ">
        <a href="/pi_cluster/os_installation/children/cluster_assembly/">
        HW Assembly
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/os_installation/children/ansible/" title="Using Ansible to manage Raspberry PI cluster" class="dd-item active">
        <a href="/pi_cluster/os_installation/children/ansible/">
        Ansible
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/os_installation/children/dongle/" title="Create a Rapsberry PI Rescue Dongle" class="dd-item ">
        <a href="/pi_cluster/os_installation/children/dongle/">
        Rescue Dongle
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/pi_cluster/docker_kubernetes/" title="Kubernetes" class="dd-item 
        
        
        
        ">
      <a href="/pi_cluster/docker_kubernetes/">
          <b>2.2. </b>Kubernetes
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/docker_kubernetes/children/2018-07-30-a/" title="Build and Deploy Kubernetes test-infra" class="dd-item ">
        <a href="/pi_cluster/docker_kubernetes/children/2018-07-30-a/">
        Test-Infra
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/docker_kubernetes/children/2018-07-14-a/" title="Deploy Flannel in PI Cluster" class="dd-item ">
        <a href="/pi_cluster/docker_kubernetes/children/2018-07-14-a/">
        Flannel
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/docker_kubernetes/children/2018-07-13-a/" title="Deply Helm and Tiller on PI Cluster" class="dd-item ">
        <a href="/pi_cluster/docker_kubernetes/children/2018-07-13-a/">
        Helm and Tiller
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/docker_kubernetes/children/2018-07-12-a/" title="Enable docker Remote API" class="dd-item ">
        <a href="/pi_cluster/docker_kubernetes/children/2018-07-12-a/">
        Docker Remote API
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/docker_kubernetes/children/2018-07-08-a/" title="Add Persistency Volume to PI Cluster" class="dd-item ">
        <a href="/pi_cluster/docker_kubernetes/children/2018-07-08-a/">
        Persistency Volume
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/docker_kubernetes/children/2018-07-03-a/" title="Creating a Raspberry 3 B&#43; Kubernetes Cluster" class="dd-item ">
        <a href="/pi_cluster/docker_kubernetes/children/2018-07-03-a/">
        Installation
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/docker_kubernetes/children/2018-06-24-a/" title="docker.io versus docker-ce" class="dd-item ">
        <a href="/pi_cluster/docker_kubernetes/children/2018-06-24-a/">
        Docker
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/docker_kubernetes/children/2018-06-19-a/" title="Add Raspberry PI node to Kubernetes Cluster in 10 min" class="dd-item ">
        <a href="/pi_cluster/docker_kubernetes/children/2018-06-19-a/">
        Add a node
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/pi_cluster/maintenance/" title="Helm &amp; Maintenance" class="dd-item 
        
        
        
        ">
      <a href="/pi_cluster/maintenance/">
          <b>2.3. </b>Helm &amp; Maintenance
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/maintenance/children/2018-09-28-a/" title="Upgrade RPI Kubernetes cluster to 1.12" class="dd-item ">
        <a href="/pi_cluster/maintenance/children/2018-09-28-a/">
        Upgrade to K8s 1.12
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/maintenance/children/2018-07-11-a/" title="Use github repo as helm chart repository" class="dd-item ">
        <a href="/pi_cluster/maintenance/children/2018-07-11-a/">
        Helm charts repo
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/maintenance/children/2018-07-02-a/" title="Compile and Test SONOBUOY" class="dd-item ">
        <a href="/pi_cluster/maintenance/children/2018-07-02-a/">
        Sonobuoy
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/maintenance/children/2018-06-30-a/" title="Update Kubernetes to 1.11 on Ubuntu" class="dd-item ">
        <a href="/pi_cluster/maintenance/children/2018-06-30-a/">
        Upgrade to K8s 1.11
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/pi_cluster/microservices/" title="MicroServices" class="dd-item 
        
        
        
        ">
      <a href="/pi_cluster/microservices/">
          <b>2.4. </b>MicroServices
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/microservices/children/2018-07-01-a/" title="Python" class="dd-item ">
        <a href="/pi_cluster/microservices/children/2018-07-01-a/">
        Python
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/microservices/children/2018-06-29-a/" title="Creating simple GO server container" class="dd-item ">
        <a href="/pi_cluster/microservices/children/2018-06-29-a/">
        GO
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/microservices/children/2018-06-28-a/" title="Creating simple Java 10 server container" class="dd-item ">
        <a href="/pi_cluster/microservices/children/2018-06-28-a/">
        Java 10
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/microservices/children/2018-06-22-a/" title="Setup your GOLANG environment" class="dd-item ">
        <a href="/pi_cluster/microservices/children/2018-06-22-a/">
        GOLANG env
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/pi_cluster/advanced/" title="Advanced &amp; WIP" class="dd-item 
        
        
        
        ">
      <a href="/pi_cluster/advanced/">
          <b>2.5. </b>Advanced &amp; WIP
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/advanced/children/2018-08-01-a/" title="Build and Deploy Kubernetes Hashicorp Vault" class="dd-item ">
        <a href="/pi_cluster/advanced/children/2018-08-01-a/">
        Hashicorp Vault
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/advanced/children/2018-07-31-a/" title="Build and Deploy Kubernetes Istio" class="dd-item ">
        <a href="/pi_cluster/advanced/children/2018-07-31-a/">
        Istio
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/advanced/children/2018-07-29-a/" title="Build and Deploy Kubernetes Kustomize" class="dd-item ">
        <a href="/pi_cluster/advanced/children/2018-07-29-a/">
        Kustomize
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/advanced/children/2018-07-18-a/" title="Compile and Test Portieris" class="dd-item ">
        <a href="/pi_cluster/advanced/children/2018-07-18-a/">
        Portieris
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/lte_to_5g/" title="LTE to 5G Simulations" class="dd-item 
        
        
        
        ">
      <a href="/lte_to_5g/">
          <b>3. </b>LTE to 5G Simulations
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/lte_to_5g/lte_and_5g_core_simulation/" title="EPC and 5GC" class="dd-item 
        
        
        
        ">
      <a href="/lte_to_5g/lte_and_5g_core_simulation/">
          <b>3.1. </b>EPC and 5GC
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/lte_to_5g/lte_and_5g_ran_simulation/" title="LTE, eLTE and 5G RAN" class="dd-item 
        
        
        
        ">
      <a href="/lte_to_5g/lte_and_5g_ran_simulation/">
          <b>3.2. </b>LTE, eLTE and 5G RAN
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/lte_to_5g/rpi_wifi_bluetooth/" title="Spectrum" class="dd-item 
        
        
        
        ">
      <a href="/lte_to_5g/rpi_wifi_bluetooth/">
          <b>3.3. </b>Spectrum
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/lte_to_5g/nsa_and_sa/" title="NSA vs SA. Option 3" class="dd-item 
        
        
        
        ">
      <a href="/lte_to_5g/nsa_and_sa/">
          <b>3.4. </b>NSA vs SA. Option 3
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/lte_to_5g/advanced/" title="Advanced &amp; WIP" class="dd-item 
        
        
        
        ">
      <a href="/lte_to_5g/advanced/">
          <b>3.5. </b>Advanced &amp; WIP
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/nfv/" title="NFV/SDN/Network Slicing" class="dd-item 
        
        
        
        ">
      <a href="/nfv/">
          <b>4. </b>NFV/SDN/Network Slicing
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/nfv/fd_io_and_opnfv/" title="FD.io &amp; OPNFV" class="dd-item 
        
        
        
        ">
      <a href="/nfv/fd_io_and_opnfv/">
          <b>4.1. </b>FD.io &amp; OPNFV
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/nfv/onap/" title="ONAP" class="dd-item 
        
        
        
        ">
      <a href="/nfv/onap/">
          <b>4.2. </b>ONAP
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/nfv/akraino/" title="Akraino" class="dd-item 
        
        
        
        ">
      <a href="/nfv/akraino/">
          <b>4.3. </b>Akraino
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/nfv/advanced/" title="Advanced &amp; WIP" class="dd-item 
        
        
        
        ">
      <a href="/nfv/advanced/">
          <b>4.5. </b>Advanced &amp; WIP
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/nfv/advanced/children/2018-07-17-a/" title="Rebuild Calico for AMD64 ad ARM32V7" class="dd-item ">
        <a href="/nfv/advanced/children/2018-07-17-a/">
        Calico
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/about/" title="About KUBEDGE" class="dd-item 
        
        
        
        ">
      <a href="/about/">
          About KUBEDGE
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Kubedge</a> > <a href='/pi_cluster/'>RPI Cluster</a> > <a href='/pi_cluster/os_installation/'>Operating System</a> > Using Ansible to manage Raspberry PI cluster
          
         
          
         
          
         
          
           
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#ansible-installation-on-the-master-node">Ansible Installation on the master node</a></li>
<li><a href="#configure-ansible">Configure ansible</a>
<ul>
<li><a href="#use-ansible">Use ansible</a>
<ul>
<li><a href="#simple-ping">Simple ping</a></li>
<li><a href="#retrieve-facts">Retrieve Facts</a></li>
<li><a href="#update-all-the-nodes-in-the-cluster">Update all the nodes in the cluster</a></li>
<li><a href="#check-the-version-of-kubeadm">Check the version  of kubeadm</a></li>
<li><a href="#check-the-temperature">Check the temperature</a></li>
<li><a href="#check-the-connected-devices">Check the connected devices</a></li>
<li><a href="#other-usefull-commands">Other usefull commands</a></li>
</ul></li>
</ul></li>
<li><a href="#reference-links">Reference Links</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>Using Ansible to manage Raspberry PI cluster</h1>
          

        


<p>Even if the ultimate goal is to manage completly the cluster using Kubernetes,
the ability to use Ansible during debug process is very usefull.
The goal here is to setup ansible inventory, basic playbooks.</p>

<p></p>

<h2 id="ansible-installation-on-the-master-node">Ansible Installation on the master node</h2>

<p>Let&rsquo;s install ansible using apt-get. A lot of python related depedencies are also installed.</p>

<pre><code class="language-bash">sudo apt-get install ansible

Reading package lists... Done
Building dependency tree
Reading state information... Done
The following additional packages will be installed:
  ieee-data libyaml-0-2 python-cffi-backend python-crypto python-cryptography python-enum34 python-httplib2 python-idna python-ipaddress python-jinja2 python-kerberos python-markupsafe
  python-netaddr python-paramiko python-pkg-resources python-pyasn1 python-selinux python-setuptools python-six python-xmltodict python-yaml
Suggested packages:
  cowsay sshpass python-crypto-dbg python-crypto-doc python-cryptography-doc python-cryptography-vectors python-enum34-doc python-jinja2-doc ipython python-netaddr-docs python-gssapi
  doc-base python-setuptools-doc
Recommended packages:
  python-winrm
The following NEW packages will be installed:
  ansible ieee-data libyaml-0-2 python-cffi-backend python-crypto python-cryptography python-enum34 python-httplib2 python-idna python-ipaddress python-jinja2 python-kerberos
  python-markupsafe python-netaddr python-paramiko python-pkg-resources python-pyasn1 python-selinux python-setuptools python-six python-xmltodict python-yaml
0 upgraded, 22 newly installed, 0 to remove and 6 not upgraded.
Need to get 4,556 kB of archives.
After this operation, 28.4 MB of additional disk space will be used.
Do you want to continue? [Y/n] y
</code></pre>

<pre><code>$ ansible --version

ansible 2.2.1.0
  config file = /etc/ansible/ansible.cfg
  configured module search path = Default w/o overrides
</code></pre>

<pre><code>sudo apt-get install sshpass

Reading package lists... Done
Building dependency tree
Reading state information... Done
The following NEW packages will be installed:
  sshpass
0 upgraded, 1 newly installed, 0 to remove and 6 not upgraded.
Need to get 11.2 kB of archives.
After this operation, 30.7 kB of additional disk space will be used.
Get:1 http://raspbian.mirrors.lucidnetworks.net/raspbian stretch/main armhf sshpass armhf 1.06-1 [11.2 kB]
Fetched 11.2 kB in 2s (4,785 B/s)
Selecting previously unselected package sshpass.
(Reading database ... 26786 files and directories currently installed.)
Preparing to unpack .../sshpass_1.06-1_armhf.deb ...
Unpacking sshpass (1.06-1) ...
Setting up sshpass (1.06-1) ...
Processing triggers for man-db (2.7.6.1-2) ...
</code></pre>

<h2 id="configure-ansible">Configure ansible</h2>

<p>Create directorties for ansible</p>

<pre><code>mkdir -p mgt/inventory
mkdir -p mgt/playbooks
mkdir -p mgt/rooles
mkdir -p mgt/roles
mkdir -p mgt/group_vars
mkdir -p mgt/files
mkdir -p mgt/inventory/host_vars
</code></pre>

<p>Let&rsquo;s check the internal cluster network</p>

<pre><code>cat /etc/hosts

192.168.2.1 kubemaster-pi.kubepi kubemaster-pi
192.168.2.101 kube-node01.kubepi kube-node01
192.168.2.102 kube-node02.kubepi kube-node02
192.168.2.103 kube-node03.kubepi kube-node03
192.168.2.104 kube-node04.kubepi kube-node04
</code></pre>

<p>Let&rsquo;s create an rsa key for Ansible SSH. Note
the cluster is still using the default pirate account
created by HypriotOS. Will change is later
once ansible is up.</p>

<pre><code>cd ~/mgt

ssh-keygen -t rsa -f mgtkey

ssh-copy-id -i mgtkey.pub pirate@kubemaster-pi
ssh-copy-id -i mgtkey.pub pirate@kube-node01
ssh-copy-id -i mgtkey.pub pirate@kube-node02
ssh-copy-id -i mgtkey.pub pirate@kube-node03
ssh-copy-id -i mgtkey.pub pirate@kube-node04
</code></pre>

<p>Create a first ansible host_var. We will use the mgtkey for ssh/ansible.</p>

<pre><code>cd ~/mgt/inventory/host_vars
cat kubemaster-pi.kubepi

ansible_host: 192.168.2.FOOBAR
ansible_port: 22
ansible_user: pirate
ansible_ssh_private_key_file: mgtkey
</code></pre>

<pre><code>for i in kube-node01 kube-node02 kube-node03 kube-node04
do
cp kubemaster-pi.kubepi $i.kubepi
done
</code></pre>

<p>Replace FOOBAR by the proper value</p>

<pre><code>vi *.kubepi
</code></pre>

<p>Create the main inventory file</p>

<pre><code>cd ~/mgt/inventory
cat hosts

---
[picluster:children]
masters
workers

[masters]
kubemaster-pi.kubepi

[workers]
kube-node01.kubepi
kube-node02.kubepi
kube-node03.kubepi
kube-node04.kubepi
</code></pre>

<h3 id="use-ansible">Use ansible</h3>

<h4 id="simple-ping">Simple ping</h4>

<pre><code>ansible picluster -i inventory/ -m ping

kube-node01.kubepi | SUCCESS =&gt; {
    &quot;changed&quot;: false,
    &quot;ping&quot;: &quot;pong&quot;
}
kube-node04.kubepi | SUCCESS =&gt; {
    &quot;changed&quot;: false,
    &quot;ping&quot;: &quot;pong&quot;
}
kube-node03.kubepi | SUCCESS =&gt; {
    &quot;changed&quot;: false,
    &quot;ping&quot;: &quot;pong&quot;
}
kubemaster-pi.kubepi | SUCCESS =&gt; {
    &quot;changed&quot;: false,
    &quot;ping&quot;: &quot;pong&quot;
}
kube-node02.kubepi | SUCCESS =&gt; {
    &quot;changed&quot;: false,
    &quot;ping&quot;: &quot;pong&quot;
}
</code></pre>

<pre><code>ansible masters -i inventory/ -m ping

kubemaster-pi.kubepi | SUCCESS =&gt; {
    &quot;changed&quot;: false,
    &quot;ping&quot;: &quot;pong&quot;
}
</code></pre>

<pre><code>ansible workers -i inventory/ -m ping

kube-node01.kubepi | SUCCESS =&gt; {
    &quot;changed&quot;: false,
    &quot;ping&quot;: &quot;pong&quot;
}
kube-node03.kubepi | SUCCESS =&gt; {
    &quot;changed&quot;: false,
    &quot;ping&quot;: &quot;pong&quot;
}
kube-node02.kubepi | SUCCESS =&gt; {
    &quot;changed&quot;: false,
    &quot;ping&quot;: &quot;pong&quot;
}
kube-node04.kubepi | SUCCESS =&gt; {
    &quot;changed&quot;: false,
    &quot;ping&quot;: &quot;pong&quot;
</code></pre>

<h4 id="retrieve-facts">Retrieve Facts</h4>

<pre><code>ansible picluster -i inventory/ -m setup
</code></pre>

<h4 id="update-all-the-nodes-in-the-cluster">Update all the nodes in the cluster</h4>

<p>Create a simple playbook</p>

<pre><code>cat playbooks/aptupdate.yml

---
- hosts: picluster
  tasks:
  - name: update apt
    become: true
    apt:
       update_cache: yes
</code></pre>

<p>Run the simple aptupdate playbook</p>

<pre><code>ansible-playbook -i inventory/ playbooks/aptupdate.yml

PLAY [picluster] ***************************************************************

TASK [setup] *******************************************************************
ok: [kubemaster-pi.kubepi]
ok: [kube-node03.kubepi]
ok: [kube-node04.kubepi]
ok: [kube-node02.kubepi]
ok: [kube-node01.kubepi]

TASK [update apt] **************************************************************
changed: [kube-node02.kubepi]
changed: [kubemaster-pi.kubepi]
changed: [kube-node01.kubepi]
changed: [kube-node03.kubepi]
changed: [kube-node04.kubepi]

PLAY RECAP *********************************************************************
kube-node01.kubepi         : ok=2    changed=1    unreachable=0    failed=0
kube-node02.kubepi         : ok=2    changed=1    unreachable=0    failed=0
kube-node03.kubepi         : ok=2    changed=1    unreachable=0    failed=0
kube-node04.kubepi         : ok=2    changed=1    unreachable=0    failed=0
kubemaster-pi.kubepi       : ok=2    changed=1    unreachable=0    failed=0
</code></pre>

<h4 id="check-the-version-of-kubeadm">Check the version  of kubeadm</h4>

<pre><code>ansible picluster -i inventory -m shell -a &quot;kubeadm version&quot;

kube-node04.kubepi | SUCCESS | rc=0 &gt;&gt;
kubeadm version: &amp;version.Info{Major:&quot;1&quot;, Minor:&quot;9&quot;, GitVersion:&quot;v1.9.8&quot;, GitCommit:&quot;c138b85178156011dc934c2c9f4837476876fb07&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-05-21T18:53:18Z&quot;, GoVersion:&quot;go1.9.3&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/arm&quot;}

kube-node03.kubepi | SUCCESS | rc=0 &gt;&gt;
kubeadm version: &amp;version.Info{Major:&quot;1&quot;, Minor:&quot;9&quot;, GitVersion:&quot;v1.9.8&quot;, GitCommit:&quot;c138b85178156011dc934c2c9f4837476876fb07&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-05-21T18:53:18Z&quot;, GoVersion:&quot;go1.9.3&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/arm&quot;}

kube-node01.kubepi | SUCCESS | rc=0 &gt;&gt;
kubeadm version: &amp;version.Info{Major:&quot;1&quot;, Minor:&quot;9&quot;, GitVersion:&quot;v1.9.8&quot;, GitCommit:&quot;c138b85178156011dc934c2c9f4837476876fb07&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-05-21T18:53:18Z&quot;, GoVersion:&quot;go1.9.3&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/arm&quot;}

kubemaster-pi.kubepi | SUCCESS | rc=0 &gt;&gt;
kubeadm version: &amp;version.Info{Major:&quot;1&quot;, Minor:&quot;9&quot;, GitVersion:&quot;v1.9.8&quot;, GitCommit:&quot;c138b85178156011dc934c2c9f4837476876fb07&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-05-21T18:53:18Z&quot;, GoVersion:&quot;go1.9.3&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/arm&quot;}

kube-node02.kubepi | SUCCESS | rc=0 &gt;&gt;
kubeadm version: &amp;version.Info{Major:&quot;1&quot;, Minor:&quot;9&quot;, GitVersion:&quot;v1.9.8&quot;, GitCommit:&quot;c138b85178156011dc934c2c9f4837476876fb07&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-05-21T18:53:18Z&quot;, GoVersion:&quot;go1.9.3&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/arm&quot;}
</code></pre>

<h4 id="check-the-temperature">Check the temperature</h4>

<pre><code>ansible picluster -i inventory -m shell -a &quot;vcgencmd measure_temp&quot;

kube-node03.kubepi | SUCCESS | rc=0 &gt;&gt;
temp=36.5'C

kubemaster-pi.kubepi | SUCCESS | rc=0 &gt;&gt;
temp=49.4'C

kube-node02.kubepi | SUCCESS | rc=0 &gt;&gt;
temp=33.2'C

kube-node04.kubepi | SUCCESS | rc=0 &gt;&gt;
temp=34.3'C

kube-node01.kubepi | SUCCESS | rc=0 &gt;&gt;
temp=32.2'C
</code></pre>

<h4 id="check-the-connected-devices">Check the connected devices</h4>

<p>Check the components of the PI composing the cluster (Those are PI 3B+)</p>

<pre><code>ansible picluster -i inventory -m shell -a &quot;lsusb&quot;

kubemaster-pi.kubepi | SUCCESS | rc=0 &gt;&gt;
Bus 001 Device 004: ID 0424:7800 Standard Microsystems Corp.
Bus 001 Device 003: ID 0424:2514 Standard Microsystems Corp. USB 2.0 Hub
Bus 001 Device 002: ID 0424:2514 Standard Microsystems Corp. USB 2.0 Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub

kube-node02.kubepi | SUCCESS | rc=0 &gt;&gt;
Bus 001 Device 004: ID 0424:7800 Standard Microsystems Corp.
Bus 001 Device 003: ID 0424:2514 Standard Microsystems Corp. USB 2.0 Hub
Bus 001 Device 002: ID 0424:2514 Standard Microsystems Corp. USB 2.0 Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub

kube-node01.kubepi | SUCCESS | rc=0 &gt;&gt;
Bus 001 Device 004: ID 0424:7800 Standard Microsystems Corp.
Bus 001 Device 003: ID 0424:2514 Standard Microsystems Corp. USB 2.0 Hub
Bus 001 Device 002: ID 0424:2514 Standard Microsystems Corp. USB 2.0 Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub

kube-node04.kubepi | SUCCESS | rc=0 &gt;&gt;
Bus 001 Device 004: ID 0424:7800 Standard Microsystems Corp.
Bus 001 Device 003: ID 0424:2514 Standard Microsystems Corp. USB 2.0 Hub
Bus 001 Device 002: ID 0424:2514 Standard Microsystems Corp. USB 2.0 Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub

kube-node03.kubepi | SUCCESS | rc=0 &gt;&gt;
Bus 001 Device 004: ID 0424:7800 Standard Microsystems Corp.
Bus 001 Device 003: ID 0424:2514 Standard Microsystems Corp. USB 2.0 Hub
Bus 001 Device 002: ID 0424:2514 Standard Microsystems Corp. USB 2.0 Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</code></pre>

<p>On the second cluster, some of the nodes are PI 3B instead of PI 3B+. LAN and WLAN are different.</p>

<pre><code>ansible picluster -i inventory -m shell -s -a &quot;lsusb&quot;

master-pi.kubedge.cloud | SUCCESS | rc=0 &gt;&gt;
Bus 001 Device 004: ID 0424:7800 Standard Microsystems Corp.
Bus 001 Device 003: ID 0424:2514 Standard Microsystems Corp. USB 2.0 Hub
Bus 001 Device 002: ID 0424:2514 Standard Microsystems Corp. USB 2.0 Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub

home-pi.kubedge.cloud | SUCCESS | rc=0 &gt;&gt;
Bus 001 Device 004: ID 10c4:8a2a Cygnal Integrated Products, Inc.
Bus 001 Device 003: ID 0424:ec00 Standard Microsystems Corp. SMSC9512/9514 Fast Ethernet Adapter
Bus 001 Device 002: ID 0424:9514 Standard Microsystems Corp. SMC9514 Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub

nas-pi.kubedge.cloud | SUCCESS | rc=0 &gt;&gt;
Bus 001 Device 003: ID 0424:ec00 Standard Microsystems Corp. SMSC9512/9514 Fast Ethernet Adapter
Bus 001 Device 002: ID 0424:9514 Standard Microsystems Corp. SMC9514 Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</code></pre>

<h4 id="other-usefull-commands">Other usefull commands</h4>

<pre><code>ansible picluster -i inventory -m shell -a &quot;lsusb&quot;
ansible picluster -i inventory -m shell -a &quot;dmesg&quot;
ansible picluster -i inventory -m shell -a &quot;usb-devices&quot;
ansible picluster -i inventory -m shell -a &quot;lsblk&quot;

ansible picluster -i inventory -m shell -a &quot;blkid&quot;
ansible picluster -i inventory -m shell -a &quot;fdisk -l&quot;
</code></pre>

<h2 id="reference-links">Reference Links</h2>

<ul>
<li>TBD</li>
</ul>

<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="/pi_cluster/os_installation/children/cluster_assembly/" title="Raspberry PI cluster Assembly"> <i class="fas fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/pi_cluster/os_installation/children/dongle/" title="Create a Rapsberry PI Rescue Dongle" style="margin-right: 0px;"><i class="fas fa-chevron-right"></i></a>
        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1540673754"></script>
    <script src="/js/perfect-scrollbar.min.js?1540673754"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1540673754"></script>
    <script src="/js/jquery.sticky.js?1540673754"></script>
    <script src="/js/featherlight.min.js?1540673754"></script>
    <script src="/js/html5shiv-printshiv.min.js?1540673754"></script>
    <script src="/js/highlight.pack.js?1540673754"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js?1540673754"></script>
    <script src="/js/learn.js?1540673754"></script>
    <script src="/js/hugo-learn.js?1540673754"></script>

    <link href="/mermaid/mermaid.css?1540673754" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1540673754"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

