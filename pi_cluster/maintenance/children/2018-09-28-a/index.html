<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.49" />
    <meta name="description" content="KUBEDGE&#39;s Blog">


    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link rel="icon" href="/images/favicon.png" type="image/x-icon" />
    <title>Upgrade RPI Kubernetes cluster to 1.12 :: KUBEDGE&#39;s Blog</title>

    
    <link href="/css/nucleus.css?1539756695" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1539756695" rel="stylesheet">
    <link href="/css/hybrid.css?1539756695" rel="stylesheet">
    <link href="/css/featherlight.min.css?1539756695" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1539756695" rel="stylesheet">
    <link href="/css/auto-complete.css?1539756695" rel="stylesheet">
    <link href="/css/theme.css?1539756695" rel="stylesheet">
    <link href="/css/hugo-theme.css?1539756695" rel="stylesheet">
    

    <script src="/js/jquery-2.x.min.js?1539756695"></script>

    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/pi_cluster/maintenance/children/2018-09-28-a/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="http://getgrav.org">
  <svg id="grav-logo" width="100%" height="100%" viewBox="0 0 504 140" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">
    <path d="M235.832,71.564l-7.98,-0.001c-1.213,0.001 -2.197,0.987 -2.197,2.204l0,15.327l-0.158,0.132c-4.696,3.962 -10.634,6.14 -16.719,6.14c-14.356,0 -26.034,-11.68 -26.034,-26.037c0,-14.358 11.678,-26.035 26.034,-26.035c5.582,0 10.919,1.767 15.437,5.113c0.877,0.649 2.093,0.56 2.866,-0.211l5.69,-5.69c0.444,-0.442 0.675,-1.055 0.639,-1.681c-0.034,-0.627 -0.336,-1.206 -0.828,-1.597c-6.76,-5.363 -15.214,-8.314 -23.805,-8.314c-21.18,0 -38.414,17.233 -38.414,38.415c0,21.183 17.234,38.415 38.414,38.415c10.937,0 21.397,-4.705 28.698,-12.914c0.358,-0.403 0.556,-0.921 0.556,-1.46l0,-19.603c0,-1.217 -0.985,-2.203 -2.2,-2.203"
      style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M502.794,34.445c-0.408,-0.616 -1.1,-0.989 -1.838,-0.989l-8.684,0c-0.879,0 -1.673,0.522 -2.022,1.329l-24.483,56.839l-24.92,-56.852c-0.352,-0.799 -1.142,-1.316 -2.012,-1.316l-8.713,0c-0.744,0 -1.44,0.373 -1.843,0.995c-0.408,0.623 -0.476,1.408 -0.174,2.09l30.186,68.858c0.352,0.799 1.143,1.317 2.017,1.317l10.992,0c0.879,0 1.673,-0.527 2.021,-1.329l29.655,-68.861c0.289,-0.68 0.222,-1.461 -0.182,-2.081"
      style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M388.683,34.772c-0.353,-0.798 -1.142,-1.316 -2.017,-1.316l-10.988,0c-0.879,0 -1.673,0.522 -2.021,1.329l-29.655,68.861c-0.294,0.675 -0.226,1.46 0.182,2.077c0.407,0.619 1.096,0.993 1.838,0.993l8.684,0c0.879,0 1.673,-0.526 2.022,-1.329l24.478,-56.842l24.92,56.854c0.353,0.798 1.143,1.317 2.013,1.317l8.717,0c0.744,0 1.44,-0.374 1.843,-0.993c0.408,-0.624 0.471,-1.41 0.174,-2.094l-30.19,-68.857Z"
      style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M309.196,81.525l0.476,-0.229c8.675,-4.191 14.279,-13.087 14.279,-22.667c0,-13.881 -11.295,-25.174 -25.176,-25.174l-31.863,0c-1.214,0 -2.199,0.988 -2.199,2.202l0,68.855c0,1.219 0.985,2.204 2.199,2.204l7.979,0c1.214,0 2.2,-0.985 2.2,-2.204l0,-58.679l21.684,0c7.059,0 12.799,5.739 12.799,12.796c0,5.885 -3.996,10.989 -9.728,12.408c-1.032,0.261 -2.064,0.393 -3.071,0.393l-7.977,0c-0.829,0 -1.585,0.467 -1.959,1.205c-0.378,0.74 -0.305,1.625 0.187,2.296l22.62,30.884c0.412,0.566 1.07,0.901 1.771,0.901l9.915,0c0.827,0 1.587,-0.467 1.96,-1.207c0.378,-0.742 0.302,-1.629 -0.186,-2.296l-15.91,-21.688Z"
      style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M107.191,80.969c-7.255,-4.794 -11.4,-8.845 -15.011,-16.109c-2.47,4.977 -8.236,12.376 -17.962,18.198c-4.856,15.106 -27.954,44.015 -35.43,39.916c-2.213,-1.212 -2.633,-2.808 -2.133,-4.456c0.536,-4.129 9.078,-13.62 9.078,-13.62c0,0 0.18,1.992 2.913,6.187c-3.609,-11.205 5.965,-25.031 8.5,-29.738c3.985,-1.269 4.274,-6.387 4.274,-6.387c0.255,-7.909 -3.278,-13.635 -6.701,-17.059c2.459,3.002 3.255,7.539 3.372,11.694l0,0.023c0.012,0.469 0.012,0.93 0.011,1.39c-0.117,3.439 -1.157,8.19 -3.383,8.19l0.006,0.03c-2.289,-0.098 -5.115,0.391 -7.639,1.18l-5.582,1.334c0,0 2.977,-0.136 4.584,1.252c-1.79,2.915 -5.769,6.533 -10.206,8.588c-6.457,2.995 -8.312,-2.964 -5.034,-6.838c0.805,-0.946 1.618,-1.745 2.387,-2.399c-0.495,-0.513 -0.807,-1.198 -0.889,-2.068c-0.001,-0.005 -0.004,-0.009 -0.005,-0.013c-0.45,-1.977 -0.202,-4.543 2.596,-8.623c0.551,-0.863 1.214,-1.748 2.007,-2.647c0.025,-0.031 0.046,-0.059 0.072,-0.089c0.034,-0.042 0.072,-0.08 0.108,-0.121c0.02,-0.023 0.039,-0.045 0.059,-0.068c0.2,-0.228 0.413,-0.45 0.639,-0.663c3.334,-3.414 8.599,-6.966 16.897,-10.152c9.675,-14.223 13.219,-16.89 13.219,-16.89c1.071,-1.096 2.943,-2.458 3.632,-2.805c-5.053,-8.781 -6.074,-21.158 -4.75,-24.493c-0.107,0.18 -0.206,0.365 -0.287,0.556c0.49,-1.143 0.819,-1.509 1.328,-2.111c1.381,-1.632 6.058,-2.488 7.737,0.971c0.895,1.844 1.063,4.232 1.034,6.023c-3.704,-0.193 -7.063,4.036 -7.063,4.036c0,0 3.067,-1.448 6.879,-1.473c0,0 1.015,0.883 2.283,2.542c-1.712,3.213 -4.524,10.021 -2.488,17.168c0.338,1.408 0.849,2.619 1.483,3.648c0.024,0.045 0.044,0.089 0.069,0.135c0.051,0.066 0.096,0.122 0.144,0.183c3.368,5.072 9.542,5.665 9.542,5.665c-2.906,-1.45 -5.274,-3.76 -6.816,-6.56c-0.8,-1.498 -1.291,-2.762 -1.592,-3.761c-1.636,-6.313 0.771,-9.999 2.149,-12.471c3.17,-4.917 8.944,-7.893 15.151,-7.185c8.712,0.995 14.968,8.862 13.973,17.571c-0.608,5.321 -3.781,9.723 -8.142,12.117c1.049,2.839 -0.073,6.28 -0.073,6.28c2.642,3.323 2.758,5.238 2.667,7.017c-3.357,-0.565 -6.618,1.701 -6.618,1.701c0,0 6.476,-1.546 10.238,1.81c2.446,2.631 4.078,5.009 5.051,6.766c1.393,2.505 7.859,2.683 7.123,7.188c-0.737,4.499 -5.669,4.542 -13.401,-0.56M69.571,0c-38.424,0 -69.571,31.148 -69.571,69.567c0,38.422 31.147,69.573 69.571,69.573c38.42,0 69.568,-31.151 69.568,-69.573c0,-38.42 -31.148,-69.567 -69.568,-69.567"
      style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M73.796,51.693c0.813,-0.814 0.813,-2.134 0,-2.947c-0.815,-0.814 -2.133,-0.814 -2.947,0c-0.815,0.813 -0.815,2.133 0,2.947c0.814,0.813 2.132,0.813 2.947,0" style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M66.445,53.149c-0.814,0.813 -0.814,2.133 0,2.947c0.813,0.814 2.133,0.814 2.947,0c0.813,-0.814 0.813,-2.134 0,-2.947c-0.814,-0.813 -2.134,-0.813 -2.947,0" style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M79.231,54.233c-1.274,-1.274 -3.339,-1.272 -4.611,0l-2.713,2.712c-1.274,1.275 -1.274,3.339 0,4.612l2.978,2.978c1.274,1.275 3.338,1.274 4.611,0l2.712,-2.712c1.274,-1.274 1.274,-3.339 0,-4.612l-2.977,-2.978Z" style="fill:#000;fill-rule:nonzero;"></path>
    <path d="M95.759,41.445c-2.151,-2.578 1.869,-7.257 4.391,-4.463c4.645,5.148 -2.237,7.041 -4.391,4.463M105.004,44.132c3.442,-6.553 -1.427,-10.381 -4.773,-13.523c-5.36,-5.039 -10.706,-7.217 -16.811,-0.241c-6.102,6.977 -2.226,15.068 3.356,19.061c5.584,3.994 14.782,1.255 18.228,-5.297"
      style="fill:#000;fill-rule:nonzero;"></path>
  </svg>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-close"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1539756695"></script>
<script type="text/javascript" src="/js/auto-complete.js?1539756695"></script>
<script type="text/javascript">
    
        var baseurl = '\/';
    
</script>
<script type="text/javascript" src="/js/search.js?1539756695"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/post/" title="Posts" class="dd-item 
        
        
        
        ">
      <a href="/post/">
          Posts
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/devops/" title="DevOps" class="dd-item 
        
        
        
        ">
      <a href="/devops/">
          <b>1. </b>DevOps
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/devops/git_gerrit/" title="Git/Gerrit" class="dd-item 
        
        
        
        ">
      <a href="/devops/git_gerrit/">
          <b>1.1. </b>Git/Gerrit
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/devops/git_gerrit/children/2018-06-25-a/" title="Setup github/gerrit behind a corporate http proxy" class="dd-item ">
        <a href="/devops/git_gerrit/children/2018-06-25-a/">
        Setup github/gerrit behind a corporate http proxy
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/devops/git_gerrit/children/2018-06-23-a/" title="Setup multiple GitHub account on a single machine" class="dd-item ">
        <a href="/devops/git_gerrit/children/2018-06-23-a/">
        Setup multiple GitHub account on a single machine
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/devops/cicd/" title="CI/CD" class="dd-item 
        
        
        
        ">
      <a href="/devops/cicd/">
          <b>1.2. </b>CI/CD
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/devops/hugo_githubpages/" title="Hugo/GitHubPages" class="dd-item 
        
        
        
        ">
      <a href="/devops/hugo_githubpages/">
          <b>1.3. </b>Hugo/GitHubPages
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
             
            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/devops/kubedgesdk/" title="Kubedge SDK" class="dd-item 
        
        
        
        ">
      <a href="/devops/kubedgesdk/">
          <b>1.4. </b>Kubedge SDK
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/devops/kubedgesdk/children/2018-07-15-a/" title="Recompile Kubernetes components for Raspberry PI" class="dd-item ">
        <a href="/devops/kubedgesdk/children/2018-07-15-a/">
        Recompile Kubernetes components for Raspberry PI
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/devops/kubedgesdk/children/2018-06-21-a/" title="Setup SingleNode Kubernetes Cluster using kubeadm" class="dd-item ">
        <a href="/devops/kubedgesdk/children/2018-06-21-a/">
        Setup SingleNode Kubernetes Cluster using kubeadm
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/devops/advanced/" title="Advanced &amp; WIP" class="dd-item 
        
        
        
        ">
      <a href="/devops/advanced/">
          <b>1.5. </b>Advanced &amp; WIP
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/devops/advanced/children/2018-07-16-a/" title="Rebuild Hyperkube images" class="dd-item ">
        <a href="/devops/advanced/children/2018-07-16-a/">
        Rebuild Hyperkube images
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/devops/advanced/children/2018-06-30-a/" title="Update Kubernetes to 1.11 on Ubuntu" class="dd-item ">
        <a href="/devops/advanced/children/2018-06-30-a/">
        Update Kubernetes to 1.11 on Ubuntu
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/devops/advanced/children/2018-06-26-a/" title="Zuul" class="dd-item ">
        <a href="/devops/advanced/children/2018-06-26-a/">
        Zuul
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/pi_cluster/" title="RPI Cluster" class="dd-item 
        parent
        
        
        ">
      <a href="/pi_cluster/">
          <b>2. </b>RPI Cluster
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/pi_cluster/os_installation/" title="Operating System" class="dd-item 
        
        
        
        ">
      <a href="/pi_cluster/os_installation/">
          <b>2.1. </b>Operating System
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/os_installation/children/2018-07-07-a/" title="Using Ansible to manage Raspberry PI cluster" class="dd-item ">
        <a href="/pi_cluster/os_installation/children/2018-07-07-a/">
        Using Ansible to manage Raspberry PI cluster
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/os_installation/2018-06-20-a/" title="Create a Rapsberry PI Rescue Dongle" class="dd-item ">
        <a href="/pi_cluster/os_installation/2018-06-20-a/">
        Create a Rapsberry PI Rescue Dongle
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/pi_cluster/docker_kubernetes/" title="Kubernetes" class="dd-item 
        
        
        
        ">
      <a href="/pi_cluster/docker_kubernetes/">
          <b>2.2. </b>Kubernetes
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/docker_kubernetes/children/2018-07-14-a/" title="Deploy Flannel in Raspberry PI cluster" class="dd-item ">
        <a href="/pi_cluster/docker_kubernetes/children/2018-07-14-a/">
        Deploy Flannel in Raspberry PI cluster
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/docker_kubernetes/children/2018-07-13-a/" title="Deploy Helm and Tiller on Rasberry PI Cluster" class="dd-item ">
        <a href="/pi_cluster/docker_kubernetes/children/2018-07-13-a/">
        Deploy Helm and Tiller on Rasberry PI Cluster
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/docker_kubernetes/children/2018-07-12-a/" title="Enable docker remote API" class="dd-item ">
        <a href="/pi_cluster/docker_kubernetes/children/2018-07-12-a/">
        Enable docker remote API
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/docker_kubernetes/children/2018-07-08-a/" title="Add Persistency Volume to PI Clusters" class="dd-item ">
        <a href="/pi_cluster/docker_kubernetes/children/2018-07-08-a/">
        Add Persistency Volume to PI Clusters
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/docker_kubernetes/children/2018-07-03-a/" title="Creating a Raspberry 3 B&#43; Kubernetes Cluster" class="dd-item ">
        <a href="/pi_cluster/docker_kubernetes/children/2018-07-03-a/">
        Creating a Raspberry 3 B&#43; Kubernetes Cluster
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/docker_kubernetes/children/2018-06-24-a/" title="docker.io versus docker-ce" class="dd-item ">
        <a href="/pi_cluster/docker_kubernetes/children/2018-06-24-a/">
        docker.io versus docker-ce
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/docker_kubernetes/children/2018-06-19-a/" title="Add Raspberry PI node to Kubernetes Cluster in 10 min" class="dd-item ">
        <a href="/pi_cluster/docker_kubernetes/children/2018-06-19-a/">
        Add Raspberry PI node to Kubernetes Cluster in 10 min
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/pi_cluster/maintenance/" title="Helm" class="dd-item 
        parent
        
        
        ">
      <a href="/pi_cluster/maintenance/">
          <b>2.3. </b>Helm
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/maintenance/children/2018-09-28-a/" title="Upgrade RPI Kubernetes cluster to 1.12" class="dd-item active">
        <a href="/pi_cluster/maintenance/children/2018-09-28-a/">
        Upgrade RPI Kubernetes cluster to 1.12
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/maintenance/children/2018-07-11-a/" title="Use github repo as helm chart repository" class="dd-item ">
        <a href="/pi_cluster/maintenance/children/2018-07-11-a/">
        Use github repo as helm chart repository
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/maintenance/children/2018-07-02-a/" title="Compile and Test SONOBUOY" class="dd-item ">
        <a href="/pi_cluster/maintenance/children/2018-07-02-a/">
        Compile and Test SONOBUOY
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/pi_cluster/microservices/" title="MicroServices" class="dd-item 
        
        
        
        ">
      <a href="/pi_cluster/microservices/">
          <b>2.4. </b>MicroServices
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/microservices/children/2018-07-30-a/" title="Build and Deploy Kubernetes test-infra" class="dd-item ">
        <a href="/pi_cluster/microservices/children/2018-07-30-a/">
        Build and Deploy Kubernetes test-infra
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/microservices/children/2018-07-01-a/" title="Creating simple Python server container" class="dd-item ">
        <a href="/pi_cluster/microservices/children/2018-07-01-a/">
        Creating simple Python server container
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/microservices/children/2018-06-29-a/" title="Creating simple GO server container" class="dd-item ">
        <a href="/pi_cluster/microservices/children/2018-06-29-a/">
        Creating simple GO server container
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/microservices/children/2018-06-28-a/" title="Creating simple Java 10 server container" class="dd-item ">
        <a href="/pi_cluster/microservices/children/2018-06-28-a/">
        Creating simple Java 10 server container
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/microservices/children/2018-06-22-a/" title="Setup your GOLANG environment" class="dd-item ">
        <a href="/pi_cluster/microservices/children/2018-06-22-a/">
        Setup your GOLANG environment
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/pi_cluster/advanced/" title="Advanced &amp; WIP" class="dd-item 
        
        
        
        ">
      <a href="/pi_cluster/advanced/">
          <b>1.5. </b>Advanced &amp; WIP
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/advanced/children/2018-08-01-a/" title="Build and Deploy Kubernetes Hashicorp Vault" class="dd-item ">
        <a href="/pi_cluster/advanced/children/2018-08-01-a/">
        Build and Deploy Kubernetes Hashicorp Vault
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/advanced/children/2018-07-31-a/" title="Build and Deploy Kubernetes Istio" class="dd-item ">
        <a href="/pi_cluster/advanced/children/2018-07-31-a/">
        Build and Deploy Kubernetes Istio
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/advanced/children/2018-07-29-a/" title="Build and Deploy Kubernetes Kustomize" class="dd-item ">
        <a href="/pi_cluster/advanced/children/2018-07-29-a/">
        Build and Deploy Kubernetes Kustomize
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pi_cluster/advanced/children/2018-07-18-a/" title="Compile and Test Portieris" class="dd-item ">
        <a href="/pi_cluster/advanced/children/2018-07-18-a/">
        Compile and Test Portieris
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/lte_to_5g/" title="LTE to 5G Simulations" class="dd-item 
        
        
        
        ">
      <a href="/lte_to_5g/">
          <b>3. </b>LTE to 5G Simulations
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/lte_to_5g/lte_and_5g_core_simulation/" title="EPC and 5GC" class="dd-item 
        
        
        
        ">
      <a href="/lte_to_5g/lte_and_5g_core_simulation/">
          <b>3.1. </b>EPC and 5GC
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/lte_to_5g/lte_and_5g_ran_simulation/" title="LTE, eLTE and 5G RAN" class="dd-item 
        
        
        
        ">
      <a href="/lte_to_5g/lte_and_5g_ran_simulation/">
          <b>3.2. </b>LTE, eLTE and 5G RAN
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/lte_to_5g/rpi_wifi_bluetooth/" title="Spectrum" class="dd-item 
        
        
        
        ">
      <a href="/lte_to_5g/rpi_wifi_bluetooth/">
          <b>3.3. </b>Spectrum
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/lte_to_5g/nsa_and_sa/" title="NSA vs SA. Option 3" class="dd-item 
        
        
        
        ">
      <a href="/lte_to_5g/nsa_and_sa/">
          <b>3.4. </b>NSA vs SA. Option 3
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/lte_to_5g/advanced/" title="Advanced &amp; WIP" class="dd-item 
        
        
        
        ">
      <a href="/lte_to_5g/advanced/">
          <b>3.5. </b>Advanced &amp; WIP
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/nfv/" title="NFV/SDN/Network Slicing" class="dd-item 
        
        
        
        ">
      <a href="/nfv/">
          <b>4. </b>NFV/SDN/Network Slicing
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/nfv/fd_io_and_opnfv/" title="FD.io &amp; OPNFV" class="dd-item 
        
        
        
        ">
      <a href="/nfv/fd_io_and_opnfv/">
          <b>4.1. </b>FD.io &amp; OPNFV
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/nfv/fd_io_and_opnfv/children/2018-07-17-a/" title="Rebuild Calico for AMD64 ad ARM32V7" class="dd-item ">
        <a href="/nfv/fd_io_and_opnfv/children/2018-07-17-a/">
        Rebuild Calico for AMD64 ad ARM32V7
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/nfv/onap/" title="ONAP" class="dd-item 
        
        
        
        ">
      <a href="/nfv/onap/">
          <b>4.2. </b>ONAP
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/nfv/akraino/" title="Akraino" class="dd-item 
        
        
        
        ">
      <a href="/nfv/akraino/">
          <b>4.3. </b>Akraino
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/nfv/advanced/" title="Advanced &amp; WIP" class="dd-item 
        
        
        
        ">
      <a href="/nfv/advanced/">
          <b>4.5. </b>Advanced &amp; WIP
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/about/" title="About KUBEDGE" class="dd-item 
        
        
        
        ">
      <a href="/about/">
          About KUBEDGE
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Kubedge</a> > <a href='/pi_cluster/'>RPI Cluster</a> > <a href='/pi_cluster/maintenance/'>Helm</a> > Upgrade RPI Kubernetes cluster to 1.12
          
         
          
         
          
         
          
           
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li><a href="#goal">Goal</a>
<ul>
<li><a href="#master-node-upgrade-using-kubeadm">Master node upgrade using kubeadm</a></li>
<li><a href="#upgrade-kubectl">Upgrade kubectl</a></li>
<li><a href="#upgrade-kubelet-on-master-node">Upgrade kubelet on master node</a></li>
<li><a href="#update-first-slave-node">Update first slave node</a>
<ul>
<li><a href="#other-slave-node">Other slave node</a></li>
</ul></li>
<li><a href="#check-consistency-of-the-cluster">Check consistency of the cluster</a></li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#reference-links">Reference Links</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>Upgrade RPI Kubernetes cluster to 1.12</h1>
          

        




<h1 id="goal">Goal</h1>

<p>The new Kubernetes 1.12 is out. THe goal is to update my two clusters to 1.12
using kubeadm 1.12</p>

<h2 id="master-node-upgrade-using-kubeadm">Master node upgrade using kubeadm</h2>

<pre><code class="language-bash"># apt-mark unhold kubeadm &amp;&amp; \
&gt; apt-get update &amp;&amp; apt-get install -y kubeadm &amp;&amp; \
&gt; apt-mark hold kubeadm
kubeadm was already not hold.
Hit:2 http://raspbian.raspberrypi.org/raspbian stretch InRelease
Hit:3 https://download.docker.com/linux/raspbian stretch InRelease
Hit:1 https://packages.cloud.google.com/apt kubernetes-xenial InRelease
Hit:5 http://archive.raspberrypi.org/debian stretch InRelease
Hit:4 https://packagecloud.io/Hypriot/rpi/debian stretch InRelease
Reading package lists... Done
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following packages will be upgraded:
  kubeadm
1 upgraded, 0 newly installed, 0 to remove and 38 not upgraded.
Need to get 8,095 kB of archives.
After this operation, 3,100 kB disk space will be freed.
Get:1 https://packages.cloud.google.com/apt kubernetes-xenial/main armhf kubeadm armhf 1.12.0-00 [8,095 kB]
Fetched 8,095 kB in 4s (1,962 kB/s)
(Reading database ... 30574 files and directories currently installed.)
Preparing to unpack .../kubeadm_1.12.0-00_armhf.deb ...
Unpacking kubeadm (1.12.0-00) over (1.11.1-00) ...
Setting up kubeadm (1.12.0-00) ...
kubeadm set on hold.
</code></pre>

<pre><code class="language-bash">sudo kubeadm upgrade plan
[preflight] Running pre-flight checks.
[upgrade] Making sure the cluster is healthy:
[upgrade/config] Making sure the configuration is correct:
[upgrade/config] Reading configuration from the cluster...
[upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -oyaml'
[upgrade] Fetching available versions to upgrade to
[upgrade/versions] Cluster version: v1.11.0
[upgrade/versions] kubeadm version: v1.12.0
[upgrade/versions] Latest stable version: v1.12.0
[upgrade/versions] Latest version in the v1.11 series: v1.11.3

Components that must be upgraded manually after you have upgraded the control plane with 'kubeadm upgrade apply':
COMPONENT   CURRENT       AVAILABLE
Kubelet     3 x v1.11.1   v1.11.3

Upgrade to the latest version in the v1.11 series:

COMPONENT            CURRENT   AVAILABLE
API Server           v1.11.0   v1.11.3
Controller Manager   v1.11.0   v1.11.3
Scheduler            v1.11.0   v1.11.3
Kube Proxy           v1.11.0   v1.11.3
CoreDNS              1.1.3     1.2.2
Etcd                 3.2.18    3.2.18

You can now apply the upgrade by executing the following command:

        kubeadm upgrade apply v1.11.3

_____________________________________________________________________

Components that must be upgraded manually after you have upgraded the control plane with 'kubeadm upgrade apply':
COMPONENT   CURRENT       AVAILABLE
Kubelet     3 x v1.11.1   v1.12.0

Upgrade to the latest stable version:

COMPONENT            CURRENT   AVAILABLE
API Server           v1.11.0   v1.12.0
Controller Manager   v1.11.0   v1.12.0
Scheduler            v1.11.0   v1.12.0
Kube Proxy           v1.11.0   v1.12.0
CoreDNS              1.1.3     1.2.2
Etcd                 3.2.18    3.2.24

You can now apply the upgrade by executing the following command:

        kubeadm upgrade apply v1.12.0

_____________________________________________________________________
</code></pre>

<pre><code class="language-bash">$ sudo kubeadm upgrade apply v1.12.0
[preflight] Running pre-flight checks.
[upgrade] Making sure the cluster is healthy:
[upgrade/config] Making sure the configuration is correct:
[upgrade/config] Reading configuration from the cluster...
[upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -oyaml'
[upgrade/apply] Respecting the --cri-socket flag that is set with higher priority than the config file.
[upgrade/version] You have chosen to change the cluster version to &quot;v1.12.0&quot;
[upgrade/versions] Cluster version: v1.11.0
[upgrade/versions] kubeadm version: v1.12.0
[upgrade/confirm] Are you sure you want to proceed with the upgrade? [y/N]: y
[upgrade/prepull] Will prepull images for components [kube-apiserver kube-controller-manager kube-scheduler etcd]
[upgrade/prepull] Prepulling image for component kube-apiserver.
[upgrade/prepull] Prepulling image for component kube-controller-manager.
[upgrade/prepull] Prepulling image for component kube-scheduler.
[upgrade/prepull] Prepulling image for component etcd.
[apiclient] Found 0 Pods for label selector k8s-app=upgrade-prepull-kube-apiserver
[apiclient] Found 0 Pods for label selector k8s-app=upgrade-prepull-etcd
[apiclient] Found 0 Pods for label selector k8s-app=upgrade-prepull-kube-controller-manager
[apiclient] Found 0 Pods for label selector k8s-app=upgrade-prepull-kube-scheduler
[apiclient] Found 1 Pods for label selector k8s-app=upgrade-prepull-kube-scheduler
[apiclient] Found 1 Pods for label selector k8s-app=upgrade-prepull-kube-apiserver
[apiclient] Found 1 Pods for label selector k8s-app=upgrade-prepull-kube-controller-manager
[apiclient] Found 1 Pods for label selector k8s-app=upgrade-prepull-etcd
[upgrade/prepull] Prepulled image for component etcd.
[upgrade/prepull] Prepulled image for component kube-apiserver.
[upgrade/prepull] Prepulled image for component kube-controller-manager.
[upgrade/prepull] Prepulled image for component kube-scheduler.
[upgrade/prepull] Successfully prepulled the images for all the control plane components
[upgrade/apply] Upgrading your Static Pod-hosted control plane to version &quot;v1.12.0&quot;...
Static pod: kube-apiserver-master-pi hash: c30b2fa49c49e091538b2ce8e4dae186
Static pod: kube-controller-manager-master-pi hash: 22f67939f8b1abea8ba99666b78b5c93
Static pod: kube-scheduler-master-pi hash: 0e545194d6b033abd681f02dfd11f4c8
Static pod: etcd-master-pi hash: 00575b778fb80d4e48241f80ceb2ac0f
[etcd] Wrote Static Pod manifest for a local etcd instance to &quot;/etc/kubernetes/tmp/kubeadm-upgraded-manifests040184315/etcd.yaml&quot;
[upgrade/staticpods] Moved new manifest to &quot;/etc/kubernetes/manifests/etcd.yaml&quot; and backed up old manifest to &quot;/etc/kubernetes/tmp/kubeadm-backup-manifests-2018-09-30-00-46-56/etcd.yaml&quot;
[upgrade/staticpods] Waiting for the kubelet to restart the component
[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s
Static pod: etcd-master-pi hash: 00575b778fb80d4e48241f80ceb2ac0f
Static pod: etcd-master-pi hash: 00575b778fb80d4e48241f80ceb2ac0f
Static pod: etcd-master-pi hash: 00575b778fb80d4e48241f80ceb2ac0f
Static pod: etcd-master-pi hash: 77c6076a4d6ee044b744b041125cf918
[apiclient] Found 1 Pods for label selector component=etcd
[upgrade/staticpods] Component &quot;etcd&quot; upgraded successfully!
[upgrade/etcd] Waiting for etcd to become available
[util/etcd] Waiting 0s for initial delay
[util/etcd] Attempting to see if all cluster endpoints are available 1/10
[upgrade/staticpods] Writing new Static Pod manifests to &quot;/etc/kubernetes/tmp/kubeadm-upgraded-manifests040184315&quot;
[controlplane] wrote Static Pod manifest for component kube-apiserver to &quot;/etc/kubernetes/tmp/kubeadm-upgraded-manifests040184315/kube-apiserver.yaml&quot;
[controlplane] wrote Static Pod manifest for component kube-controller-manager to &quot;/etc/kubernetes/tmp/kubeadm-upgraded-manifests040184315/kube-controller-manager.yaml&quot;
[controlplane] wrote Static Pod manifest for component kube-scheduler to &quot;/etc/kubernetes/tmp/kubeadm-upgraded-manifests040184315/kube-scheduler.yaml&quot;
[upgrade/staticpods] Moved new manifest to &quot;/etc/kubernetes/manifests/kube-apiserver.yaml&quot; and backed up old manifest to &quot;/etc/kubernetes/tmp/kubeadm-backup-manifests-2018-09-30-00-46-56/kube-apiserver.yaml&quot;
[upgrade/staticpods] Waiting for the kubelet to restart the component
[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s
Static pod: kube-apiserver-master-pi hash: c30b2fa49c49e091538b2ce8e4dae186
Static pod: kube-apiserver-master-pi hash: a92106d6db4c8b5835a47f5f56c33fdb
[apiclient] Found 1 Pods for label selector component=kube-apiserver
[upgrade/staticpods] Component &quot;kube-apiserver&quot; upgraded successfully!
[upgrade/staticpods] Moved new manifest to &quot;/etc/kubernetes/manifests/kube-controller-manager.yaml&quot; and backed up old manifest to &quot;/etc/kubernetes/tmp/kubeadm-backup-manifests-2018-09-30-00-46-56/kube-controller-manager.yaml&quot;
[upgrade/staticpods] Waiting for the kubelet to restart the component
[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s
Static pod: kube-controller-manager-master-pi hash: 22f67939f8b1abea8ba99666b78b5c93
Static pod: kube-controller-manager-master-pi hash: 980b4156606df8caafd0ad8abacc1485
[apiclient] Found 1 Pods for label selector component=kube-controller-manager
[upgrade/staticpods] Component &quot;kube-controller-manager&quot; upgraded successfully!
[upgrade/staticpods] Moved new manifest to &quot;/etc/kubernetes/manifests/kube-scheduler.yaml&quot; and backed up old manifest to &quot;/etc/kubernetes/tmp/kubeadm-backup-manifests-2018-09-30-00-46-56/kube-scheduler.yaml&quot;
[upgrade/staticpods] Waiting for the kubelet to restart the component
[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s
Static pod: kube-scheduler-master-pi hash: 0e545194d6b033abd681f02dfd11f4c8
Static pod: kube-scheduler-master-pi hash: 1b5ec5be325bf29f60be62789416a99e
[apiclient] Found 1 Pods for label selector component=kube-scheduler
[upgrade/staticpods] Component &quot;kube-scheduler&quot; upgraded successfully!
[uploadconfig] storing the configuration used in ConfigMap &quot;kubeadm-config&quot; in the &quot;kube-system&quot; Namespace
[kubelet] Creating a ConfigMap &quot;kubelet-config-1.12&quot; in namespace kube-system with the configuration for the kubelets in the cluster
[kubelet] Downloading configuration for the kubelet from the &quot;kubelet-config-1.12&quot; ConfigMap in the kube-system namespace
[kubelet] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;
[patchnode] Uploading the CRI Socket information &quot;/var/run/dockershim.sock&quot; to the Node API object &quot;master-pi&quot; as an annotation
[bootstraptoken] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials
[bootstraptoken] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
[bootstraptoken] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster
[addons] Applied essential addon: CoreDNS
[addons] Applied essential addon: kube-proxy

[upgrade/successful] SUCCESS! Your cluster was upgraded to &quot;v1.12.0&quot;. Enjoy!

[upgrade/kubelet] Now that your control plane is upgraded, please proceed with upgrading your kubelets if you haven't already done so.
</code></pre>

<p>Kubernetes servers are running v1.12</p>

<pre><code class="language-bash">$ kubectl version
Client Version: version.Info{Major:&quot;1&quot;, Minor:&quot;11&quot;, GitVersion:&quot;v1.11.1&quot;, GitCommit:&quot;b1b29978270dc22fecc592ac55d903350454310a&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-07-17T18:53:20Z&quot;, GoVersion:&quot;go1.10.3&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/arm&quot;}
Server Version: version.Info{Major:&quot;1&quot;, Minor:&quot;12&quot;, GitVersion:&quot;v1.12.0&quot;, GitCommit:&quot;0ed33881dc4355495f623c6f22e7dd0b7632b7c0&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-09-27T16:55:41Z&quot;, GoVersion:&quot;go1.10.4&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/arm&quot;}
</code></pre>

<p>my kubelets are still running kubernetes v1.11.1</p>

<pre><code class="language-bash">$ kubectl get nodes
NAME        STATUS    ROLES     AGE       VERSION
home-pi     Ready     &lt;none&gt;    86d       v1.11.1
master-pi   Ready     master    86d       v1.11.1
nas-pi      Ready     &lt;none&gt;    85d       v1.11.1
</code></pre>

<h2 id="upgrade-kubectl">Upgrade kubectl</h2>

<p>Install newer version of kubectl using apt-get</p>

<pre><code class="language-bash">$ sudo apt-get install kubectl
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following packages will be upgraded:
  kubectl
1 upgraded, 0 newly installed, 0 to remove and 37 not upgraded.
Need to get 8,639 kB of archives.
After this operation, 1,783 kB of additional disk space will be used.
Get:1 https://packages.cloud.google.com/apt kubernetes-xenial/main armhf kubectl armhf 1.12.0-00 [8,639 kB]
Fetched 8,639 kB in 6s (1,270 kB/s)
(Reading database ... 30574 files and directories currently installed.)
Preparing to unpack .../kubectl_1.12.0-00_armhf.deb ...
Unpacking kubectl (1.12.0-00) over (1.11.1-00) ...
Setting up kubectl (1.12.0-00) ...
</code></pre>

<p>Check that kubectl is now 1.12</p>

<pre><code class="language-bash">$ kubectl version
Client Version: version.Info{Major:&quot;1&quot;, Minor:&quot;12&quot;, GitVersion:&quot;v1.12.0&quot;, GitCommit:&quot;0ed33881dc4355495f623c6f22e7dd0b7632b7c0&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-09-27T17:05:32Z&quot;, GoVersion:&quot;go1.10.4&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/arm&quot;}
Server Version: version.Info{Major:&quot;1&quot;, Minor:&quot;12&quot;, GitVersion:&quot;v1.12.0&quot;, GitCommit:&quot;0ed33881dc4355495f623c6f22e7dd0b7632b7c0&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2018-09-27T16:55:41Z&quot;, GoVersion:&quot;go1.10.4&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/arm&quot;}
</code></pre>

<h2 id="upgrade-kubelet-on-master-node">Upgrade kubelet on master node</h2>

<pre><code class="language-bash">$ sudo apt-get upgrade -y kubelet
Reading package lists... Done
Building dependency tree
Reading state information... Done
Calculating upgrade... Done
The following packages will be upgraded:
...
</code></pre>

<pre><code class="language-bash">$ sudo systemctl restart kubelet
</code></pre>

<pre><code class="language-bash">$ kubectl get nodes
NAME        STATUS   ROLES    AGE   VERSION
home-pi     Ready    &lt;none&gt;   86d   v1.11.1
master-pi   Ready    master   86d   v1.12.0
nas-pi      Ready    &lt;none&gt;   85d   v1.11.1
</code></pre>

<p>Looks that as useual something is wrong with flannel CNI</p>

<pre><code class="language-bash">$ kubectl get all --all-namespaces
NAMESPACE     NAME                                             READY   STATUS    RESTARTS   AGE
default       pod/helm-rpi-kubeplay-arm32v7-6cb66496c6-6gvf6   1/1     Running   0          60d
kube-system   pod/coredns-576cbf47c7-nzhfj                     1/1     Running   0          37m
kube-system   pod/coredns-576cbf47c7-wkmhr                     1/1     Running   0          37m
kube-system   pod/etcd-master-pi                               1/1     Running   0          3m43s
kube-system   pod/kube-apiserver-master-pi                     1/1     Running   2          3m43s
kube-system   pod/kube-controller-manager-master-pi            1/1     Running   1          3m43s
kube-system   pod/kube-flannel-ds-4495g                        1/1     Running   4          75d
kube-system   pod/kube-flannel-ds-52ssk                        0/1     Error     10         75d
kube-system   pod/kube-flannel-ds-gj65n                        1/1     Running   4          75d

Investigation shows:

```bash
$ kubectl logs pod/kube-flannel-ds-52ssk -n kube-system
I0930 01:34:13.768925       1 main.go:475] Determining IP address of default interface
I0930 01:34:13.778622       1 main.go:488] Using interface with name wlan0 and address 192.168.1.95
I0930 01:34:13.778716       1 main.go:505] Defaulting external address to interface address (192.168.1.95)
I0930 01:34:14.168318       1 kube.go:131] Waiting 10m0s for node controller to sync
I0930 01:34:14.168890       1 kube.go:294] Starting kube subnet manager
I0930 01:34:15.169929       1 kube.go:138] Node controller sync successful
I0930 01:34:15.170035       1 main.go:235] Created subnet manager: Kubernetes Subnet Manager - master-pi
I0930 01:34:15.170064       1 main.go:238] Installing signal handlers
I0930 01:34:15.170415       1 main.go:353] Found network config - Backend type: vxlan
I0930 01:34:15.170797       1 vxlan.go:120] VXLAN config: VNI=1 Port=0 GBP=false DirectRouting=false
E0930 01:34:15.256843       1 main.go:280] Error registering network: failed to configure interface flannel.1: failed to ensure address of interface flannel.1: link has incompatible addresses. Remove additional addresses and try again. &amp;netlink.Vxlan{LinkAttrs:netlink.LinkAttrs{Index:5, MTU:1450, TxQLen:0, Name:&quot;flannel.1&quot;, HardwareAddr:net.HardwareAddr{0x26, 0xd5, 0xd0, 0xdd, 0x56, 0x1a},
...
</code></pre>

<p>Let&rsquo;s apply usual receipe
``bash
sudo ip link delete flannel.1</p>

<pre><code>
Brute force fix seems to have done the fix....This is lucky we don't have production traffic on that node.
```bash
$ kubectl get pods -n kube-system
NAME                                    READY   STATUS    RESTARTS   AGE
coredns-576cbf47c7-nzhfj                1/1     Running   0          51m
coredns-576cbf47c7-wkmhr                1/1     Running   0          51m
etcd-master-pi                          1/1     Running   0          17m
kube-apiserver-master-pi                1/1     Running   2          17m
kube-controller-manager-master-pi       1/1     Running   1          17m
kube-flannel-ds-4495g                   1/1     Running   4          75d
kube-flannel-ds-52ssk                   1/1     Running   13         75d
kube-flannel-ds-gj65n                   1/1     Running   4          75d
kube-proxy-c2264                        1/1     Running   0          51m
kube-proxy-snjsg                        1/1     Running   0          49m
kube-proxy-zgqjb                        1/1     Running   1          50m
kube-scheduler-master-pi                1/1     Running   1          17m
kubernetes-dashboard-7d59788d44-rchkk   1/1     Running   25         83d
tiller-deploy-b59fcc885-dbvlv           1/1     Running   0          60d
</code></pre>

<h2 id="update-first-slave-node">Update first slave node</h2>

<pre><code class="language-bash">sudo apt-get clean
sudo apt-get update
sudo apt-get install kubeadm
sudo apt-get install kubelet
sudo kubeadm upgrade node config --kubelet-version $(kubelet --version | cut -d ' ' -f 2)
sudo systemctl restart kubelet
</code></pre>

<p>Same flannel issue</p>

<pre><code class="language-bash">$ kubectl get pods -n kube-system
NAME                                    READY   STATUS             RESTARTS   AGE
coredns-576cbf47c7-nzhfj                1/1     Running            0          87m
coredns-576cbf47c7-wkmhr                1/1     Running            1          87m
etcd-master-pi                          1/1     Running            0          53m
kube-apiserver-master-pi                1/1     Running            2          53m
kube-controller-manager-master-pi       1/1     Running            1          53m
kube-flannel-ds-4495g                   0/1     CrashLoopBackOff   10         75d
...
</code></pre>

<p>same hack to fix the issue</p>

<pre><code class="language-bash">sudo ip link delete flannel.1
</code></pre>

<p>same hack seems to be effective</p>

<pre><code class="language-bash">$ kubectl get pods -n kube-system
NAME                                    READY   STATUS    RESTARTS   AGE
coredns-576cbf47c7-nzhfj                1/1     Running   0          111m
coredns-576cbf47c7-wkmhr                1/1     Running   1          111m
etcd-master-pi                          1/1     Running   0          77m
kube-apiserver-master-pi                1/1     Running   2          77m
kube-controller-manager-master-pi       1/1     Running   1          77m
kube-flannel-ds-4495g                   1/1     Running   11         75d
...
</code></pre>

<h3 id="other-slave-node">Other slave node</h3>

<pre><code>sudo apt-get clean
sudo apt-get update
sudo apt-get install kubeadm
sudo apt-get install kubelet
sudo kubeadm upgrade node config --kubelet-version $(kubelet --version | cut -d ' ' -f 2)
sudo systemctl restart kubelet
sudo ip link delete flannel.1
</code></pre>

<h2 id="check-consistency-of-the-cluster">Check consistency of the cluster</h2>

<pre><code class="language-bash">$ kubectl get pods -n kube-system
NAME                                    READY   STATUS    RESTARTS   AGE
coredns-576cbf47c7-nzhfj                1/1     Running   1          143m
coredns-576cbf47c7-wkmhr                1/1     Running   1          143m
etcd-master-pi                          1/1     Running   0          109m
kube-apiserver-master-pi                1/1     Running   2          109m
kube-controller-manager-master-pi       1/1     Running   1          109m
kube-flannel-ds-4495g                   1/1     Running   11         76d
kube-flannel-ds-52ssk                   1/1     Running   13         76d
kube-flannel-ds-gj65n                   1/1     Running   13         76d
kube-proxy-c2264                        1/1     Running   1          143m
kube-proxy-snjsg                        1/1     Running   1          141m
kube-proxy-zgqjb                        1/1     Running   1          142m
kube-scheduler-master-pi                1/1     Running   1          109m
kubernetes-dashboard-7d59788d44-rchkk   1/1     Running   25         83d
tiller-deploy-b59fcc885-dbvlv           1/1     Running   0          60d
</code></pre>

<pre><code class="language-bash">$ kubectl get nodes
NAME        STATUS   ROLES    AGE   VERSION
home-pi     Ready    &lt;none&gt;   86d   v1.12.0
master-pi   Ready    master   86d   v1.12.0
nas-pi      Ready    &lt;none&gt;   86d   v1.12.0
</code></pre>

<h2 id="conclusion">Conclusion</h2>

<ul>
<li>At a glance, the cluster seems to be healthy</li>
<li>I still need to find sometool like sonobuoy to validate that the cluster is healthy</li>
</ul>

<h2 id="reference-links">Reference Links</h2>

<ul>
<li><a href="https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade-1-12/">Official Upgrade documentation</a></li>
</ul>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="/pi_cluster/maintenance/" title="Helm"> <i class="fas fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/pi_cluster/maintenance/children/2018-07-11-a/" title="Use github repo as helm chart repository" style="margin-right: 0px;"><i class="fas fa-chevron-right"></i></a>
        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1539756696"></script>
    <script src="/js/perfect-scrollbar.min.js?1539756696"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1539756696"></script>
    <script src="/js/jquery.sticky.js?1539756696"></script>
    <script src="/js/featherlight.min.js?1539756696"></script>
    <script src="/js/html5shiv-printshiv.min.js?1539756696"></script>
    <script src="/js/highlight.pack.js?1539756696"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js?1539756696"></script>
    <script src="/js/learn.js?1539756696"></script>
    <script src="/js/hugo-learn.js?1539756696"></script>

    <link href="/mermaid/mermaid.css?1539756696" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1539756696"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

